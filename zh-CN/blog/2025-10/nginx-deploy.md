---
lastUpdated: true
commentabled: true
recommended: true
title: Nginx ç°åº¦å‘å¸ƒã€å®¹é”™ä¸é™æµé…ç½®æœ€ä½³å®è·µ
description: Nginx ç°åº¦å‘å¸ƒã€å®¹é”™ä¸é™æµé…ç½®æœ€ä½³å®è·µ
date: 2025-10-31 09:20:00 
pageClass: blog-page-class
cover: /covers/nginx.svg
---

åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒWeb æœåŠ¡éœ€è¦åº”å¯¹ç‰ˆæœ¬è¿­ä»£ã€æœåŠ¡å™¨æ•…éšœã€é«˜å¹¶å‘è¯·æ±‚ç­‰å¤æ‚æƒ…å†µã€‚Nginx ä½œä¸ºè½»é‡çº§é«˜æ€§èƒ½çš„åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œåœ¨è¿™äº›åœºæ™¯ä¸­å‘æŒ¥ç€å…³é”®ä½œç”¨ã€‚æœ¬æ–‡å°†ç»“åˆå®é™…æ¡ˆä¾‹ï¼Œä»‹ç»å¦‚ä½•ä½¿ç”¨ Nginx å®ç°ï¼š

- ç°åº¦å‘å¸ƒï¼ˆæµé‡æŒ‰æ¯”ä¾‹åˆ†é…ï¼‰
- å®¹é”™ä¿æŠ¤ï¼ˆè‡ªåŠ¨å‰”é™¤æ•…éšœèŠ‚ç‚¹ï¼‰
- é™æµæ§åˆ¶ï¼ˆé˜²æ­¢æ¶æ„è¯·æ±‚æ‰“çˆ†æ¥å£ï¼‰
- HTTPS æ”¯æŒï¼ˆä¿è¯ä¼ è¾“å®‰å…¨ï¼‰

## ç°åº¦å‘å¸ƒï¼šæŒ‰æ¯”ä¾‹åˆ†æµ ##

ç°åº¦å‘å¸ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š*æ–°ç‰ˆæœ¬ä¸Šçº¿æ—¶ï¼Œå…ˆè®©éƒ¨åˆ†æµé‡è¿›å…¥æ–°ç‰ˆæœ¬ï¼Œè§‚å¯Ÿç¨³å®šæ€§ï¼Œå†é€æ­¥æ”¾é‡*ã€‚

### é…ç½®ç¤ºä¾‹ 

```txt
upstream backend {
    server 192.168.0.101 weight=8;   # è€ç‰ˆæœ¬æœåŠ¡å™¨ï¼Œ80% æµé‡
    server 192.168.0.102 weight=2;   # æ–°ç‰ˆæœ¬æœåŠ¡å™¨ï¼Œ20% æµé‡
}
```

**ğŸ” è¯´æ˜**ï¼š

- `weight=8` å’Œ `weight=2` ä»£è¡¨æµé‡åˆ†é…æ¯”ä¾‹ï¼ˆçº¦ 80% : 20%ï¼‰ã€‚
- éšç€æ–°ç‰ˆæœ¬ç¨³å®šï¼Œå¯ä»¥é€æ­¥æé«˜å…¶æƒé‡ã€‚

## å®¹é”™ä¿æŠ¤ï¼šè‡ªåŠ¨å‰”é™¤å¼‚å¸¸èŠ‚ç‚¹ ##

åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸å¯é¿å…ä¼šé‡åˆ°æŸå°æœåŠ¡å™¨æŒ‚æ‰æˆ–å“åº”è¶…æ—¶çš„æƒ…å†µã€‚Nginx æä¾›äº† å¥åº·æ£€æŸ¥æœºåˆ¶ï¼š

### é…ç½®ç¤ºä¾‹ ###

```ini
upstream backend {
    server 192.168.0.101 weight=8 max_fails=3 fail_timeout=30s;
    server 192.168.0.102 weight=2 max_fails=3 fail_timeout=30s;
}
```

**ğŸ” è¯´æ˜**ï¼š

- `max_fails=3`ï¼š30 ç§’å†…å¤±è´¥ 3 æ¬¡å³è®¤ä¸ºè¯¥èŠ‚ç‚¹ä¸å¯ç”¨ã€‚
- `fail_timeout=30s`ï¼šåœ¨ 30 ç§’å†…æš‚åœå‘è¯¥èŠ‚ç‚¹è½¬å‘è¯·æ±‚ã€‚
- åˆ°æœŸå Nginx ä¼šé‡æ–°å°è¯•ï¼ŒèŠ‚ç‚¹æ¢å¤åè‡ªåŠ¨é‡æ–°åŠ å…¥ã€‚

## é™æµæ§åˆ¶ï¼šé˜²æ­¢æ¥å£è¢«æ‰“çˆ† ##

åœ¨é«˜å¹¶å‘åœºæ™¯ä¸­ï¼Œå¦‚æœæ²¡æœ‰æµé‡æ§åˆ¶ï¼Œå¯èƒ½å‡ºç°æ¥å£é›ªå´©ã€‚Nginx æä¾›äº† åŸºäºæ¼æ¡¶ç®—æ³•çš„é™æµã€‚

### é…ç½®ç¤ºä¾‹ ###

```ini
http {
    # å®šä¹‰é™æµåŒºåŸŸï¼Œå¤§å° 10MB
    limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;

    upstream backend {
        server 192.168.0.101 weight=8 max_fails=3 fail_timeout=30s;
        server 192.168.0.102 weight=2 max_fails=3 fail_timeout=30s;
    }

    server {
        listen 443 ssl;
        server_name example.com;

        # SSL è¯ä¹¦é…ç½®
        ssl_certificate     /etc/nginx/ssl/example.crt;
        ssl_certificate_key /etc/nginx/ssl/example.key;

        location / {
            # é™æµç­–ç•¥ï¼šæ¯ä¸ª IP æ¯ç§’æœ€å¤š 10 ä¸ªè¯·æ±‚ï¼Œçªå‘æœ€å¤š 20 ä¸ª
            limit_req zone=api_limit burst=20 nodelay;

            proxy_pass http://backend;
        }
    }
}
```

**ğŸ” è¯´æ˜**ï¼š

- `limit_req_zone $binary_remote_addr ...` â†’ æŒ‰å®¢æˆ·ç«¯ IP åšé™æµã€‚
- `rate=10r/s` â†’ æ¯ç§’å…è®¸ 10 ä¸ªè¯·æ±‚ã€‚
- `burst=20` â†’ çªå‘è¯·æ±‚ä¸Šé™ 20ã€‚
- `nodelay` â†’ è¶…è¿‡é€Ÿç‡ä½†æœªè¶…è¿‡çªå‘æ—¶ç«‹å³å¤„ç†ï¼Œå¦åˆ™æ’é˜Ÿã€‚

## HTTPS é…ç½®ï¼šä¿è¯ä¼ è¾“å®‰å…¨ ##

ç”Ÿäº§ç¯å¢ƒä¸­å¿…é¡»å¼€å¯ HTTPS æ¥ä¿éšœä¼ è¾“å®‰å…¨ï¼Œé…ç½®å¦‚ä¸‹ï¼š

```ini
server {
    listen 443 ssl;
    server_name example.com;

    ssl_certificate     /etc/nginx/ssl/example.crt;
    ssl_certificate_key /etc/nginx/ssl/example.key;

    ssl_protocols       TLSv1.2 TLSv1.3;
    ssl_ciphers         HIGH:!aNULL:!MD5;

    location / {
        proxy_pass http://backend;
    }
}
```

**ğŸ” è¯´æ˜**ï¼š

- ä½¿ç”¨ TLS1.2 å’Œ TLS1.3ï¼Œé¿å…è€æ—§åè®®æ¼æ´ã€‚
- å¼ºåˆ¶ä½¿ç”¨é«˜å¼ºåº¦åŠ å¯†å¥—ä»¶ã€‚

## æœ€ä½³å®è·µæµç¨‹ ##

### ä¸Šçº¿æ–°ç‰ˆæœ¬ ###

- åˆå§‹åˆ†æµ 10% â†’ `weight=1`
- é€æ­¥å¢åŠ è‡³ 50% â†’ æœ€åæ›¿æ¢æ—§ç‰ˆæœ¬

### åº”å¯¹æ•…éšœ ###

- èŠ‚ç‚¹å¼‚å¸¸æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å¥åº·èŠ‚ç‚¹
- é˜²æ­¢å•ç‚¹æ•…éšœæ‹–å®æ•´ä¸ªæœåŠ¡

### é˜²æ­¢è¢«æ‰“çˆ† ###

- æ¯ä¸ª IP é™åˆ¶ QPS
- é…åˆ Redis/MQ ç­‰åç«¯å‰Šå³°å¤„ç†

### é…ç½®æ›´æ–° ###

ä¿®æ”¹é…ç½®åæ‰§è¡Œï¼š

```bash
nginx -t   # æ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡®
nginx -s reload   # å¹³æ»‘åŠ è½½ï¼Œæ— ä¸­æ–­æ›´æ–°
```

## å®Œæ•´é…ç½®æ¨¡æ¿ï¼ˆæ¨èï¼‰ ##

```ini
http {
    # å®šä¹‰é™æµç­–ç•¥
    limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;

    upstream backend {
        server 192.168.0.101 weight=8 max_fails=3 fail_timeout=30s;
        server 192.168.0.102 weight=2 max_fails=3 fail_timeout=30s;
    }

    server {
        listen 443 ssl;
        server_name example.com;

        # SSL é…ç½®
        ssl_certificate     /etc/nginx/ssl/example.crt;
        ssl_certificate_key /etc/nginx/ssl/example.key;
        ssl_protocols       TLSv1.2 TLSv1.3;
        ssl_ciphers         HIGH:!aNULL:!MD5;

        location / {
            # æ¯ä¸ª IP æ¯ç§’æœ€å¤š 10 ä¸ªè¯·æ±‚ï¼Œçªå‘æœ€å¤š 20
            limit_req zone=api_limit burst=20 nodelay;

            proxy_pass http://backend;
        }
    }
}
```

## ç»“è®º ##

é€šè¿‡åˆç†çš„ Nginx é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶å®ç°ï¼š

- ç°åº¦å‘å¸ƒï¼šæŒ‰æµé‡æ¯”ä¾‹å¹³æ»‘ä¸Šçº¿æ–°ç‰ˆæœ¬
- å®¹é”™ä¿æŠ¤ï¼šè‡ªåŠ¨å‰”é™¤å¼‚å¸¸èŠ‚ç‚¹ï¼Œä¿è¯é«˜å¯ç”¨
- é™æµé˜²æŠ¤ï¼šé˜²æ­¢æ¶æ„è¯·æ±‚æˆ–æµé‡æ´ªå³°å‹å®æœåŠ¡
- HTTPS æ”¯æŒï¼šä¿éšœä¼ è¾“å®‰å…¨ï¼Œç¬¦åˆå®‰å…¨åˆè§„

è¿™å¥—é…ç½®åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­å·²è¢«å¹¿æ³›éªŒè¯ï¼Œé€‚åˆç”µå•†ã€é‡‘èã€è§†é¢‘ç‚¹æ’­ç­‰é«˜å¹¶å‘åœºæ™¯ã€‚
