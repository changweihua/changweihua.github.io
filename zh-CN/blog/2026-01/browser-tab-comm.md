---
lastUpdated: true
commentabled: true
recommended: true
title: è·¨æ ‡ç­¾é¡µæ•°æ®åŒæ­¥å®Œå…¨æŒ‡å—
description: å¦‚ä½•é€‰æ‹©æœ€ä¼˜é€šä¿¡æ–¹æ¡ˆ
date: 2026-01-06 09:30:00 
pageClass: blog-page-class
cover: /covers/html5.svg
---

## äº”å¤§è·¨æ ‡ç­¾é¡µé€šä¿¡æ–¹æ¡ˆå¯¹æ¯”ä¸æœ€ä½³å®è·µ ##

> æ·±å…¥å¯¹æ¯” postMessageã€MessageChannelã€BroadcastChannelã€sessionStorageã€localStorage äº”ç§è·¨çª—å£é€šä¿¡æŠ€æœ¯ï¼Œå¸®åŠ©å¼€å‘è€…åšå‡ºæ­£ç¡®çš„æŠ€æœ¯é€‰æ‹©ã€‚

## å‰è¨€ ##

æœ¬æ–‡è¯¦ç»†åˆ†æäº”ç§è·¨æµè§ˆå™¨æ ‡ç­¾é¡µé€šä¿¡æ–¹æ¡ˆçš„ä¼˜åŠ£ï¼Œé€šè¿‡å®é™…åœºæ™¯åˆ†æå’Œä»£ç ç¤ºä¾‹ï¼Œæœ€ç»ˆç»™å‡ºå†³ç­–æŒ‡å—ã€‚
å¿«é€Ÿå¯¼èˆª

- ğŸ¯ æƒ³å¿«é€Ÿäº†è§£æ¨èæ–¹æ¡ˆï¼Ÿâ†’ è·³åˆ°ç¬¬ 11 èŠ‚
- ğŸ“Š æƒ³çœ‹æŠ€æœ¯å¯¹æ¯”è¡¨ï¼Ÿâ†’ æŸ¥çœ‹é™„å½•
- ğŸ’» æƒ³çœ‹ä»£ç å®ç°ï¼Ÿâ†’ è·³åˆ°ç¬¬ 6 èŠ‚

## ä¸€ã€é—®é¢˜åœºæ™¯ï¼ˆé€šç”¨åŒ–æè¿°ï¼‰ ##

### èƒŒæ™¯ ###

åœ¨ç°ä»£ Web åº”ç”¨ä¸­ï¼Œç»å¸¸éœ€è¦åœ¨å¤šä¸ªæµè§ˆå™¨æ ‡ç­¾é¡µä¹‹é—´è¿›è¡Œå®æ—¶æ•°æ®åŒæ­¥ã€‚è¿™ç§éœ€æ±‚åœ¨è®¸å¤šåœºæ™¯ä¸‹éƒ½å¾ˆå¸¸è§ï¼š

å…¸å‹åº”ç”¨åœºæ™¯ï¼š

- ğŸ“‹ ç”¨æˆ·åœ¨åå°ç®¡ç†ç³»ç»Ÿä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒæ—¶å…¶ä»–æ ‡ç­¾é¡µçš„ç”¨æˆ·åˆ—è¡¨éœ€è¦å®æ—¶åˆ·æ–°
- ğŸ”„ åœ¨çº¿ç¼–è¾‘å·¥å…·ä¸­ï¼Œä¸€ä¸ªæ ‡ç­¾é¡µæ–°å¢äº†å†…å®¹ï¼Œå…¶ä»–æ ‡ç­¾é¡µéœ€è¦åŒæ­¥æ›´æ–°
- âœï¸ è´­ç‰©è½¦åœ¨å¤šä¸ªæ ‡ç­¾é¡µæ‰“å¼€ï¼Œä»»æ„ä¸€ä¸ªæ ‡ç­¾é¡µä¿®æ”¹å•†å“æ•°é‡ï¼Œå…¶ä»–é¡µé¢è‡ªåŠ¨åŒæ­¥
- ğŸ“Š ä»ªè¡¨æ¿ä¸­çš„å¤šä¸ªå›¾è¡¨æ¥è‡ªä¸åŒæ ‡ç­¾é¡µï¼Œéœ€è¦ä¿æŒæ•°æ®ä¸€è‡´
- ğŸ® å¤šäººåä½œåº”ç”¨ä¸­ï¼Œä¸€ä¸ªç”¨æˆ·åœ¨æ ‡ç­¾é¡µ A ä½œå‡ºæ“ä½œï¼Œæ ‡ç­¾é¡µ B éœ€è¦å®æ—¶æ„ŸçŸ¥

### ç°è±¡ï¼šæ•°æ®å­¤å²›é—®é¢˜ ###

åœ¨æ²¡æœ‰è·¨é¡µé¢é€šä¿¡æœºåˆ¶çš„æƒ…å†µä¸‹ï¼š

- âŒ å¼¹çª—æ›´æ–°æ•°æ®åï¼Œæ–°æ ‡ç­¾é¡µä»æ˜¾ç¤ºæ—§æ•°æ®
- âŒ ç”¨æˆ·éœ€è¦æ‰‹åŠ¨åˆ·æ–°æ‰èƒ½çœ‹åˆ°æœ€æ–°å†…å®¹
- âŒ å¤šä¸ªå·¥ä½œçª—å£é—´ä¿¡æ¯ä¸åŒæ­¥ï¼Œå½±å“å·¥ä½œæ•ˆç‡
- âŒ å®¹æ˜“é€ æˆæ•°æ®ä¸€è‡´æ€§é—®é¢˜

### éœ€æ±‚å®šä¹‰ ###

å®ç°*è·¨æ ‡ç­¾é¡µçš„é€æ˜*ã€*å®æ—¶æ•°æ®åŒæ­¥*æœºåˆ¶ã€‚

## äºŒã€äº”å¤§æ–¹æ¡ˆå¿«é€Ÿå¯¹æ¯” ##

|  **ç‰¹æ€§**  |   **postMessage**   |  **MessageChannel**  |   **BroadcastChannel**   |  **sessionStorage**  |   **localStorage**   |
| :------------- | :-----------: | :------------- | :-----------: | :------------- | :-----------: |
|  é€šä¿¡æ¨¡å¼  |  çˆ¶å­å•å‘  |  ä¸€å¯¹ä¸€åŒå‘  |  å¤šç«¯å¹¿æ’­  |  äº‹ä»¶ç›‘å¬  |  äº‹ä»¶ç›‘å¬  |
|  éœ€è¦çª—å£å¼•ç”¨  |  âœ… æ˜¯  |  âœ… æ˜¯  |  âŒ å¦  |  âŒ å¦  |  âŒ å¦  |
|  è·¨æºæ”¯æŒ  |  âœ… æ˜¯  |  âœ… æ˜¯  |  âŒ åŒæº  |  âŒ åŒæº  |  âŒ åŒæº  |
|  çª—å£åˆ·æ–°å  |  âŒ æ–­å¼€  |  âŒ æ–­å¼€  |  âœ… æœ‰æ•ˆ  |  âœ… ä¿ç•™  |  âœ… ä¿ç•™  |
|  å®æ—¶æ€§  |  âœ… ç«‹å³  |  âœ… ç«‹å³  |  âœ… ç«‹å³  |  âš ï¸ å»¶è¿Ÿ  |  âš ï¸ å»¶è¿Ÿ  |
|  åŒé¡µé¢é€šä¿¡  |  âœ… å¯ä»¥  |  âœ… å¯ä»¥  |  âœ… å¯ä»¥  |  âŒ ä¸èƒ½  |  âŒ ä¸èƒ½  |
|  å®ç°å¤æ‚åº¦  |  ä¸­ç­‰  |  é«˜  |  ä½  |  ä¸­ç­‰  |  ä¸­ç­‰  |
|  æ¨èæŒ‡æ•°  |  â­â­  |  â­  |  â­â­â­â­â­  |  â­  |  â­  |

> æ¨èï¼šBroadcastChannel â­â­â­â­â­ï¼ˆåŒæºåœºæ™¯ï¼‰

## ä¸‰ã€postMessage æ–¹æ¡ˆ ##

### åŸç† ###

`postMessage` æ˜¯æœ€åŸºç¡€çš„è·¨çª—å£é€šä¿¡æ–¹å¼ï¼Œé€šè¿‡å‘ç‰¹å®šçª—å£å‘é€æ¶ˆæ¯å®ç°é€šä¿¡ã€‚

### ä»£ç ç¤ºä¾‹ ###

```javascript
// å‘é€ç«¯ï¼ˆä¸»çª—å£ï¼‰
const newWindow = window.open(url, '_blank');
newWindow.postMessage({
  type: 'DATA_UPDATE',
  data: { id: 123 }
}, '*');

// æ¥æ”¶ç«¯ï¼ˆæ–°çª—å£ï¼‰
window.addEventListener('message', (event) => {
  if (event.origin !== window.location.origin) return;
  if (event.data.type === 'DATA_UPDATE') {
    console.log('æ”¶åˆ°æ•°æ®:', event.data.data);
  }
});
```

### å±€é™æ€§ ###

| **é—®é¢˜**        |      **å½±å“**      |
| :------------- | :-----------: |
|  éœ€è¦çª—å£å¼•ç”¨  | ä¸»çª—å£åˆ·æ–°åå¼•ç”¨ä¸¢å¤±ï¼Œæ— æ³•æ¢å¤  |
|  æ–°çª—å£åˆ·æ–°åæ— æ³•é€šä¿¡  | éœ€æ‰‹åŠ¨é‡å»ºè¿æ¥  |
|  æ–°çª—å£ç‹¬ç«‹æ‰“å¼€ä¸æ”¯æŒ  | æ— æ³•å»ºç«‹é€šä¿¡  |
|  ç®¡ç†å¤æ‚  | å¤šçª—å£æ—¶ä»£ç é‡å¤ä¸”éš¾ç»´æŠ¤  |

### é€‚ç”¨åœºæ™¯ ###

- âœ… è·¨æºé€šä¿¡
- âœ… æµè§ˆå™¨å…¼å®¹æ€§è¦æ±‚æé«˜
- âŒ ä¸é€‚åˆï¼šå®æ—¶åŒæ­¥ã€å¤šçª—å£ã€è‡ªåŠ¨æ¢å¤

## å››ã€MessageChannel æ–¹æ¡ˆ ##

### åŸç† ###

`MessageChannel` æä¾›ä¸€å¯¹ä¸€çš„åŒå‘é€šä¿¡é€šé“ï¼Œé€šè¿‡ä¼ é€’ Port å¯¹è±¡å»ºç«‹é€šé“ã€‚

### ä»£ç ç¤ºä¾‹ ###

```javascript
// å‘é€ç«¯ï¼ˆä¸»çª—å£ï¼‰
const newWindow = window.open(url, '_blank');
const { port1, port2 } = new MessageChannel();

// å°† port2 ä¼ ç»™æ–°çª—å£
newWindow.postMessage({ port: port2 }, '*', [port2]);

// é€šè¿‡ port1 æ”¶å‘æ¶ˆæ¯
port1.onmessage = (event) => {
  console.log('æ”¶åˆ°:', event.data);
};
port1.postMessage({ type: 'SYNC', data: {...} });

// æ¥æ”¶ç«¯ï¼ˆæ–°çª—å£ï¼‰
window.addEventListener('message', (event) => {
  if (event.ports.length) {
    const port = event.ports[0];
    port.onmessage = (msg) => {
      console.log('æ¥æ”¶åˆ°:', msg.data);
    };
    port.start();
  }
});
```

### å±€é™æ€§ ###

| **é—®é¢˜**        |      **å½±å“**      |
| :------------- | :-----------: |
|  éœ€è¦ç®¡ç†ç«¯å£å¼•ç”¨  | å¼•ç”¨ä¸¢å¤±å¯¼è‡´é€šä¿¡æ–­å¼€  |
|  æ–°çª—å£åˆ·æ–°éœ€é‡è¿  | éœ€é¢å¤–çš„é‡è¿é€»è¾‘  |
|  å®ç°å¤æ‚  | ç«¯å£è½¬ç§»ã€`start()` ç­‰æœºåˆ¶å¤æ‚  |
|  ä¸æ”¯æŒä¸€å¯¹å¤š  | å¤šçª—å£éœ€å»ºç«‹å¤šæ¡é€šé“  |

### é€‚ç”¨åœºæ™¯ ###

- âœ… éœ€è¦åŒå‘é€šä¿¡
- âœ… è·¨æºé€šä¿¡
- âœ… é€šä¿¡é¢‘ç¹ä¸”å¯é æ€§è¦æ±‚é«˜

## äº”ã€BroadcastChannel æ–¹æ¡ˆ â­ æ¨è ##

### åŸç† ###

`BroadcastChannel` æä¾›ä¸€ä¸ªå‘½åé€šé“ï¼ŒåŒä¸€æµè§ˆä¸Šä¸‹æ–‡å†…æ‰€æœ‰åŒæºçš„æ ‡ç­¾é¡µéƒ½å¯ä»¥è‡ªåŠ¨è®¢é˜…è¯¥é€šé“ï¼Œå®ç°çœŸæ­£çš„å¹¿æ’­é€šä¿¡ã€‚

### ä»£ç ç¤ºä¾‹ ###

```javascript
// å‘é€ç«¯ï¼ˆä»»æ„çª—å£ï¼‰
const channel = new BroadcastChannel('alarm_sync_channel');

channel.postMessage({
  alarmId: 123,
  deviceId: 456,
  devicePath: '/factory/workshop',
  deviceName: 'Device-A'
});

// æ¥æ”¶ç«¯ï¼ˆæ‰€æœ‰åŒæºæ ‡ç­¾é¡µè‡ªåŠ¨æ¥æ”¶ï¼‰
const channel = new BroadcastChannel('alarm_sync_channel');

channel.onmessage = (event) => {
  const { alarmId, deviceId, devicePath, deviceName } = event.data;
  console.log('è‡ªåŠ¨åŒæ­¥:', { alarmId, deviceId, devicePath, deviceName });
  updateDeviceData(deviceId);
};

// ç»„ä»¶å¸è½½æ—¶å…³é—­é€šé“
onUnmounted(() => {
  channel.close();
});
```

### æ ¸å¿ƒä¼˜åŠ¿ ###

| **ä¼˜åŠ¿**        |      **è¯´æ˜**      |
| :------------- | :-----------: |
|  æ— éœ€çª—å£å¼•ç”¨  | é€šè¿‡é€šé“åç§°è‡ªåŠ¨å‘ç°ï¼Œå®Œå…¨è§£è€¦  |
|  è‡ªåŠ¨æ¢å¤  | çª—å£åˆ·æ–°åè‡ªåŠ¨é‡æ–°è¿æ¥  |
|  ç‹¬ç«‹æ‰“å¼€æ”¯æŒ  | ä»»ä½•æ–¹å¼æ‰“å¼€çš„åŒæºçª—å£éƒ½è‡ªåŠ¨åŠ å…¥  |
|  ä»£ç ç®€æ´  | API ç®€å•ç›´è§‚ï¼Œä»£ç é‡å°‘ `50%+`  |
|  å¹¿æ’­ç‰¹æ€§  | ä¸€æ¡æ¶ˆæ¯æ‰€æœ‰ç›‘å¬è€…éƒ½æ¥æ”¶  |
|  å†…å­˜é«˜æ•ˆ  | æ— éœ€ç®¡ç†ç«¯å£ç”Ÿå‘½å‘¨æœŸ  |

## å…­ã€Storage æ–¹æ¡ˆå¯¹æ¯” ##

`sessionStorage` ä¸ `localStorage` çš„é—®é¢˜

è¿™ä¸¤ç§å­˜å‚¨æ–¹æ¡ˆåŸæœ¬ç”¨äºæ•°æ®æŒä¹…åŒ–ï¼Œä¸æ˜¯ä¸ºäº†æ¶ˆæ¯é€šä¿¡ã€‚ç”¨æ¥å®ç°è·¨é¡µé¢é€šä¿¡å­˜åœ¨æ ¹æœ¬æ€§ç¼ºé™·ï¼š

### æ ¸å¿ƒé—®é¢˜ ###

| **é—®é¢˜**        |      **è¯´æ˜**      |     **å½±å“**      |
| :------------- | :-----------: | :-----------: |
|  åŒé¡µé¢æ— æ³•è§¦å‘äº‹ä»¶  | åŒä¸€æ ‡ç­¾é¡µä¿®æ”¹æ— æ³•é€šçŸ¥è‡ªå·±  | å‘é€ç«¯å’Œæ¥æ”¶ç«¯å¿…é¡»åˆ†å¼€  |
|  æ¶ˆæ¯ä¼šè¢«è¦†ç›–  | å¿«é€Ÿå‘é€å¤šæ¡æ¶ˆæ¯æ—¶ï¼Œåé¢çš„è¦†ç›–å‰é¢çš„  | éœ€è¦ç‰ˆæœ¬å·/æ—¶é—´æˆ³æœºåˆ¶  |
|  éœ€è¦è½®è¯¢  | æ— æ³•å®æ—¶æ„ŸçŸ¥æ›´æ–°ï¼Œéœ€å®šæ—¶æ£€æŸ¥  | æ¶ˆè€— CPUï¼Œå»¶è¿Ÿå¤§  |
|  æ¶ˆæ¯æ˜“ä¸¢å¤±  | âš ï¸å¦‚æœæ¥æ”¶ç«¯æœªåŠæ—¶æ£€æŸ¥ï¼Œæ¶ˆæ¯è¢«è¦†ç›–å°±ä¸¢äº†  | å¯¼è‡´ `10%+` çš„æ¶ˆæ¯ä¸¢å¤±  |
|  å­˜å‚¨æ±¡æŸ“  | å¤§é‡æ¶ˆæ¯å æ»¡ `5-10MB` é™åˆ¶  | å½±å“å…¶ä»–åŠŸèƒ½  |
|  åºåˆ—åŒ–å¼€é”€  | é¢‘ç¹ JSON è½¬æ¢  | æ€§èƒ½ä¸‹é™  |

### æ·±å…¥åˆ†æï¼šä¸ºä»€ä¹ˆä¼šæœ‰æ¶ˆæ¯ä¸¢å¤± ###

#### åœºæ™¯æ¨¡æ‹Ÿï¼šè´­ç‰©è½¦åŒæ­¥å¤±è´¥ ####

æƒ³è±¡ä½ åœ¨ä¸¤ä¸ªæµè§ˆå™¨æ ‡ç­¾é¡µæ‰“å¼€äº†è´­ç‰©åº”ç”¨ï¼š

*æ ‡ç­¾é¡µ Aï¼ˆè´­ç‰©è½¦ï¼‰* å’Œ *æ ‡ç­¾é¡µ Bï¼ˆå•†å“è¯¦æƒ…ï¼‰* éƒ½åœ¨ç›‘å¬ `storage` äº‹ä»¶ã€‚

**é—®é¢˜å‘ç”Ÿè¿‡ç¨‹**ï¼š

```txt
æ—¶é—´çº¿          æ ‡ç­¾é¡µ Aï¼ˆè´­ç‰©è½¦ï¼‰      æ ‡ç­¾é¡µ Bï¼ˆå•†å“è¯¦æƒ…ï¼‰       Storage
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
T1  ç”¨æˆ·ç‚¹å‡» +5 ä»¶å•†å“
    â”œâ”€ sessionStorage.setItem('cart', {productId:1, qty:5})
    â””â”€ storage äº‹ä»¶è§¦å‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ âœ… æ”¶åˆ°å¹¶æ›´æ–° UI             â† storage ä¸­: {id:1,qty:5}

T2  ç”¨æˆ·å¿«é€Ÿå† +3 ä»¶
    â”œâ”€ sessionStorage.setItem('cart', {productId:1, qty:8})
    â””â”€ storage äº‹ä»¶è§¦å‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â³ æ­£åœ¨å¤„ç† (JS æ‰§è¡Œä¸­)      â† storage ä¸­: {id:1,qty:8}
                                    ï¼ˆè¿˜æ²¡æ¥å¾—åŠè¯»å–ï¼‰

T3  ç”¨æˆ·å†æ¬¡ +2 ä»¶ï¼ˆç½‘ç»œå¡é¡¿ï¼‰
    â”œâ”€ sessionStorage.setItem('cart', {productId:1, qty:10})
    â””â”€ storage äº‹ä»¶è§¦å‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ğŸ“¢ æ–°äº‹ä»¶æ¥äº†ï¼             â† storage ä¸­: {id:1,qty:10}
                                    âŒ ä¹‹å‰ T2 çš„ qty:8 ä¸¢å¤±äº†
                                    
T4  æ ‡ç­¾é¡µ B äº‹ä»¶å¤„ç†å®Œæ¯•
    â””â”€ ä» storage è¯»å–: {id:1, qty:10}
    â””â”€ å±•ç¤º: è´­ç‰©è½¦ä¸­æœ‰ 10 ä»¶å•†å“
    â””â”€ é—®é¢˜: æ¼æ‰äº†ä¸­é—´çš„ qty:8 æ›´æ–°ï¼
```

**æ ¸å¿ƒåŸå› **ï¼š

- Storage è®¾è®¡æ˜¯è¦†ç›–å¼çš„

```javascript
// sessionStorage åªèƒ½å­˜ä¸€ä¸ªå€¼
sessionStorage.setItem('cart', data);  // æ–°å€¼è¦†ç›–æ—§å€¼
sessionStorage.getItem('cart');         // å§‹ç»ˆåªèƒ½å–åˆ°æœ€åä¸€ä¸ª

// ä¸­é—´çš„æ›´æ–°æ¶ˆæ¯ä¸¢å¤±äº†
```

- äº‹ä»¶è§¦å‘æ»å

```txt
æ ‡ç­¾é¡µ A å‘é€æ¶ˆæ¯
   â†“ (ç½‘ç»œ/çº¿ç¨‹å»¶è¿Ÿ)
æ ‡ç­¾é¡µ B äº‹ä»¶é˜Ÿåˆ—
   â†“ (ç­‰å¾… JS æ‰§è¡Œæ—¶é—´)
æ ‡ç­¾é¡µ B å¤„ç†äº‹ä»¶
   â†“
æ­¤æ—¶å·²ç»é”™è¿‡äº†å¥½å‡ æ¡æ¶ˆæ¯
```

- è½®è¯¢æ–¹å¼æ— æ³•æ•è·æ‰€æœ‰æ›´æ–°

```javascript
// æ¥æ”¶ç«¯æ¯ 500ms æ£€æŸ¥ä¸€æ¬¡
setInterval(() => {
  const latest = sessionStorage.getItem('cart');
  // é—®é¢˜ï¼šå¦‚æœä¸¤æ¬¡è½®è¯¢ä¹‹é—´å‘ç”Ÿäº†å¤šæ¡æ›´æ–°ï¼Œåªèƒ½çœ‹åˆ°æœ€åä¸€æ¡
  // æ‰€æœ‰ä¸­é—´çš„æ›´æ–°éƒ½ä¸¢å¤±äº†
}, 500);
```

#### æ•°æ®ä¸¢å¤±çš„å…·ä½“åœºæ™¯ ####

**åœºæ™¯ 1ï¼šé«˜é¢‘æ›´æ–°å¯¼è‡´çš„ä¸¢å¤±**

```javascript
// ç”¨æˆ·åœ¨ 100ms å†…å¿«é€Ÿä¿®æ”¹è´­ç‰©è½¦
for (let i = 0; i < 10; i++) {
  sessionStorage.setItem('cart_qty', i);  // å¿«é€Ÿå†™å…¥ 0, 1, 2, 3..., 9
}

// æ¥æ”¶ç«¯å¯èƒ½åªæ”¶åˆ°ï¼š
// - äº‹ä»¶ 1ï¼šqty = 2
// - äº‹ä»¶ 2ï¼šqty = 5 
// - äº‹ä»¶ 3ï¼šqty = 9

// ä¸¢å¤±æ¶ˆæ¯æ•°ï¼š7 æ¡ï¼ˆ70% ä¸¢å¤±ç‡ï¼‰
```

**åœºæ™¯ 2ï¼šæ¥æ”¶ç«¯å¤„ç†å»¶è¿Ÿå¯¼è‡´çš„ä¸¢å¤±**

```javascript
// å‘é€ç«¯ï¼šå¿«é€Ÿå‘é€ 3 æ¡æ¶ˆæ¯
sessionStorage.setItem('msg', {id: 1, data: 'message 1'});  // æ—¶é—´ T1
sessionStorage.setItem('msg', {id: 2, data: 'message 2'});  // æ—¶é—´ T2
sessionStorage.setItem('msg', {id: 3, data: 'message 3'});  // æ—¶é—´ T3

// æ¥æ”¶ç«¯çš„å¤„ç†æ—¶é—´çº¿ï¼š
// T1 æ—¶åˆ»ï¼šstorage äº‹ä»¶è§¦å‘ â†’ å¼€å§‹å¤„ç†ç¬¬ 1 æ¡æ¶ˆæ¯
// T2 æ—¶åˆ»ï¼šæ”¶åˆ°æ–°æ¶ˆæ¯ï¼Œä½†ä¸Šä¸€æ¡è¿˜æ²¡å¤„ç†å®Œ
// T2 + 50msï¼šå¤„ç†å®Œç¬¬ 1 æ¡ï¼Œä½† storage å€¼å·²ç»æ˜¯ç¬¬ 3 æ¡äº†
// ç»“æœï¼šæ¶ˆæ¯ 2 å’Œæ¶ˆæ¯ 3 è¢«åˆå¹¶ï¼Œå®é™…ä¸Šåªèƒ½è¯»åˆ°æ¶ˆæ¯ 3

// æ¶ˆæ¯ä¸¢å¤±æ•°ï¼š2 æ¡ï¼ˆ66% ä¸¢å¤±ç‡ï¼‰
```

#### ä¸ºä»€ä¹ˆ BroadcastChannel ä¸ä¼šä¸¢å¤± ####

```javascript
// BroadcastChannel æœ‰äº‹ä»¶é˜Ÿåˆ—æœºåˆ¶
const channel = new BroadcastChannel('sync');

// å³ä½¿æ¥æ”¶ç«¯å¿™ï¼Œæ¶ˆæ¯ä¹Ÿä¼šè¢«æ’é˜Ÿ
channel.postMessage({id: 1});  // âœ… é˜Ÿåˆ—ä¸­
channel.postMessage({id: 2});  // âœ… é˜Ÿåˆ—ä¸­
channel.postMessage({id: 3});  // âœ… é˜Ÿåˆ—ä¸­

channel.onmessage = (event) => {
  // æ¯æ¡æ¶ˆæ¯éƒ½ä¼šè§¦å‘å•ç‹¬çš„äº‹ä»¶
  console.log(event.data.id);  // è¾“å‡º: 1, 2, 3 (æ— ä¸¢å¤±)
};
```

**å¯¹æ¯”æ€»ç»“**ï¼š

| **æ–¹æ¡ˆ**        |      **æ¶ˆæ¯å¤„ç†æ–¹å¼**      | **ä¸¢å¤±ç‡**        |      **åŸå› **      |
| :------------- | :-----------: | :------------- | :-----------: |
|  Storage  | è¦†ç›–å¼å­˜å‚¨ + äº‹ä»¶  |  10-70%  | ä¸­é—´æ¶ˆæ¯è¢«è¦†ç›–ï¼Œè½®è¯¢ä¹Ÿæ— æ³•æ•è·  |
|  BroadcastChannel  | äº‹ä»¶é˜Ÿåˆ—  |  0%  | æ¯æ¡æ¶ˆæ¯éƒ½æœ‰ç‹¬ç«‹äº‹ä»¶ï¼Œä¿è¯é€è¾¾  |
|  postMessage  | æ¶ˆæ¯é˜Ÿåˆ—  |  0%  | æµè§ˆå™¨ä¿è¯æ¶ˆæ¯é¡ºåºå’Œé€è¾¾  |
|  MessageChannel  | ç«¯å£é˜Ÿåˆ—  |  0%  | åŒå‘å¯é é€šé“  |

#### å®Œæ•´å®ç°ç¤ºä¾‹ï¼ˆä»ç„¶ä¸æ¨èï¼‰ ####

```javascript
// ========== æ¶ˆæ¯é˜Ÿåˆ—åŒ…è£…ç±» ==========
class StorageMessageQueue {
  constructor(channelName = 'message_queue') {
    this.channelName = channelName;
    this.messageId = 0;
    this.listeners = [];
    this.setupListener();
  }

  setupListener() {
    window.addEventListener('storage', (event) => {
      if (event.key === this.channelName && event.newValue) {
        const message = JSON.parse(event.newValue);
        this.listeners.forEach(cb => cb(message));
        // æ¸…ç†æ¶ˆæ¯
        sessionStorage.removeItem(this.channelName);
      }
    });
  }

  send(data) {
    const message = {
      id: ++this.messageId,
      timestamp: Date.now(),
      data,
    };
    sessionStorage.setItem(this.channelName, JSON.stringify(message));
  }

  onMessage(callback) {
    this.listeners.push(callback);
  }

  close() {
    this.listeners = [];
  }
}

// ========== ä½¿ç”¨æ–¹å¼ ==========
// å‘é€ç«¯
const queue = new StorageMessageQueue('alarm_sync');
function nextAlarm(row) {
  queue.send({
    alarmId: row.id,
    deviceId: row.deviceId,
  });
}

// æ¥æ”¶ç«¯
const queue = new StorageMessageQueue('alarm_sync');
queue.onMessage((message) => {
  updateDevice(message.data.deviceId);
});
```

**é—®é¢˜**ï¼š

- âŒ ä»£ç é‡å¤§ 3 å€ä»¥ä¸Š
- âŒ éœ€è¦æ‰‹åŠ¨æ¸…ç†æ¶ˆæ¯
- âŒ ä»æœ‰æ¶ˆæ¯ä¸¢å¤±é£é™©
- âŒ æ€§èƒ½ä½äº BroadcastChannel
- âŒ éš¾ä»¥è°ƒè¯•å’Œç»´æŠ¤

## ä¸ƒã€äº”ç§æ–¹æ¡ˆæ·±åº¦åœºæ™¯å¯¹æ¯” ##

### åœºæ™¯ 1ï¼šä¸»çª—å£åˆ·æ–°åçš„é€šä¿¡æ¢å¤ ###

**ç”¨æˆ·åœºæ™¯**ï¼šä¸»çª—å£å¤„ç†æŠ¥è­¦ï¼Œæ–°çª—å£æ‰“å¼€è¯Šæ–­é¡µé¢ã€‚æ­¤æ—¶ä¸»çª—å£æ„å¤–åˆ·æ–°ã€‚

**postMessage æ–¹æ¡ˆ**

```javascript
// âŒ ä¸»çª—å£åˆ·æ–°åï¼ŒnewWindow å¼•ç”¨ä¸¢å¤±
const newWindow = window.open(url);
// é¡µé¢åˆ·æ–°...
// newWindow å˜é‡è¢«é‡ç½®ï¼Œæ— æ³•ç»§ç»­é€šä¿¡
```

**MessageChannel æ–¹æ¡ˆ**

```javascript
// âš ï¸ éœ€è¦é‡æ–°å»ºç«‹è¿æ¥
// ä¸»çª—å£åˆ·æ–°åï¼ŒåŸæœ‰ port1 å¤±æ•ˆ
// éœ€è¦é¢å¤–çš„é‡è¿æœºåˆ¶ï¼Œå¢åŠ å¤æ‚åº¦
```

**BroadcastChannel æ–¹æ¡ˆ â­**

```javascript
// âœ… è‡ªåŠ¨æ¢å¤
const channel = new BroadcastChannel('alarm_sync_channel');
// é¡µé¢åˆ·æ–°...
// è‡ªåŠ¨é‡æ–°è¿æ¥åˆ°é€šé“
channel.postMessage(data);  // å¯ä»¥ç»§ç»­ä½¿ç”¨
```

**sessionStorage æ–¹æ¡ˆ**

```javascript
// âš ï¸ æ•°æ®ä¿ç•™ï¼Œä½†éœ€è½®è¯¢
sessionStorage.setItem('alarm_sync', JSON.stringify(data));
// é¡µé¢åˆ·æ–°...
// æ•°æ®ä»åœ¨ï¼Œä½†æ¥æ”¶ç«¯éœ€è½®è¯¢æ£€æµ‹ç‰ˆæœ¬å·
let lastId = 0;
setInterval(() => {
  const msg = JSON.parse(sessionStorage.getItem('alarm_sync'));
  if (msg?.id > lastId) {
    lastId = msg.id;
    updateDevice(msg.deviceId);
  }
}, 500);  // å»¶è¿Ÿ 500ms æ‰èƒ½æ„ŸçŸ¥
```

### åœºæ™¯ 2ï¼šæ–°çª—å£ç‹¬ç«‹æ‰“å¼€ ###

**ç”¨æˆ·åœºæ™¯**ï¼šç”¨æˆ·é€šè¿‡ç›´æ¥åœ¨åœ°å€æ æ‰“å¼€æ–°æ ‡ç­¾é¡µï¼Œè®¿é—®è¯Šæ–­é¡µé¢ã€‚

**postMessage æ–¹æ¡ˆ**

```javascript
// âŒ æ— æ³•å»ºç«‹é€šä¿¡
// ä¸»çª—å£æ²¡æœ‰å¯¹æ–°çª—å£çš„å¼•ç”¨
// æ–°é¡µé¢æ— æ³•ä¸ä¸»çª—å£é€šä¿¡
```

**MessageChannel æ–¹æ¡ˆ**

```javascript
// âŒ æ— æ³•ç›´æ¥é€šä¿¡
// æ–°çª—å£ä¸çŸ¥é“è¦è¿æ¥åˆ°å“ªä¸ªé€šé“
```

**BroadcastChannel æ–¹æ¡ˆ â­**

```javascript
// âœ… è‡ªåŠ¨è¿æ¥
const channel = new BroadcastChannel('alarm_sync_channel');
channel.onmessage = (event) => {
  // è‡ªåŠ¨æ¥æ”¶å…¶ä»–æ ‡ç­¾é¡µçš„æ¶ˆæ¯ï¼Œæ— éœ€ä»»ä½•é¢å¤–é…ç½®
};
```

**sessionStorage æ–¹æ¡ˆ**

```javascript
// âš ï¸ å¯è§æ•°æ®ï¼Œä½†æ— æ³•æ„ŸçŸ¥æ›´æ–°
const data = JSON.parse(sessionStorage.getItem('alarm_sync'));
// é—®é¢˜ï¼šæ–°çª—å£æ‰“å¼€åï¼Œæ— æ³•çŸ¥é“ "æœ‰æ–°æ¶ˆæ¯æ¥äº†"
// éœ€è¦å®šæ—¶è½®è¯¢æˆ–ä½¿ç”¨å…¶ä»–æœºåˆ¶é€šçŸ¥
```

### åœºæ™¯ 3ï¼šå¤šçª—å£åŒæ­¥ ###

**ç”¨æˆ·åœºæ™¯**ï¼šç”¨æˆ·åŒæ—¶æ‰“å¼€äº† 3 ä¸ªè¯Šæ–­é¡µé¢ï¼Œéœ€è¦å®ƒä»¬å…±äº«åŒä¸€ä¸ªè®¾å¤‡çš„æ•°æ®æ›´æ–°ã€‚

**postMessage æ–¹æ¡ˆ**

```javascript
// âŒ æ— æ³•å®ç°ä¼˜é›…
const window1 = window.open(url1);
const window2 = window.open(url2);
const window3 = window.open(url3);

// å‘é€æ¶ˆæ¯æ—¶éœ€è¦é€ä¸€å‘é€
window1.postMessage(data, '*');
window2.postMessage(data, '*');
window3.postMessage(data, '*');
// ä»£ç é‡å¤ï¼Œéš¾ä»¥ç»´æŠ¤
```

**MessageChannel æ–¹æ¡ˆ**

```javascript
// âš ï¸ å¯ä»¥ä½†å¤æ‚
// éœ€è¦ä¸ºæ¯ä¸ªçª—å£å»ºç«‹å•ç‹¬çš„ MessageChannel
const { port1: port1_w1, port2: port2_w1 } = new MessageChannel();
const { port1: port1_w2, port2: port2_w2 } = new MessageChannel();
const { port1: port1_w3, port2: port2_w3 } = new MessageChannel();

// åˆ†åˆ«åˆå§‹åŒ–æ¯ä¸ªè¿æ¥
window1.postMessage({ port: port2_w1 }, '*', [port2_w1]);
window2.postMessage({ port: port2_w2 }, '*', [port2_w2]);
window3.postMessage({ port: port2_w3 }, '*', [port2_w3]);

// å‘é€æ¶ˆæ¯æ—¶ä»éœ€é€ä¸€å‘é€
port1_w1.postMessage(data);
port1_w2.postMessage(data);
port1_w3.postMessage(data);
```

**BroadcastChannel æ–¹æ¡ˆ â­**

```javascript
// âœ… å®Œç¾æ”¯æŒ
const channel = new BroadcastChannel('alarm_sync_channel');
// æ‰€æœ‰ 3 ä¸ªè¯Šæ–­é¡µé¢éƒ½è‡ªåŠ¨ç›‘å¬åŒä¸€é€šé“
// å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œæ‰€æœ‰ç›‘å¬è€…éƒ½æ¥æ”¶
channel.postMessage(data);
// ç®€æ´ã€é«˜æ•ˆã€å®Œå…¨è‡ªåŠ¨åŒ–
```

**sessionStorage æ–¹æ¡ˆ**

```javascript
// âš ï¸ å¯ä»¥ä½†éœ€å¤æ‚é€»è¾‘
sessionStorage.setItem('alarm_sync_v2', JSON.stringify({
  version: Date.now(),
  data: { deviceId: 456 }
}));

// 3 ä¸ªçª—å£éƒ½éœ€è¦å®šæ—¶è½®è¯¢
let lastVersion = 0;
setInterval(() => {
  const stored = JSON.parse(sessionStorage.getItem('alarm_sync_v2') || '{}');
  if (stored.version && stored.version > lastVersion) {
    lastVersion = stored.version;
    updateDevice(stored.data.deviceId);
  }
}, 500);

// é—®é¢˜ï¼š3 ä¸ªçª—å£éƒ½åœ¨è½®è¯¢ï¼Œæ¶ˆè€— CPU
// æœ‰æ¶ˆæ¯ä¸¢å¤±é£é™©ï¼ˆç‰ˆæœ¬å·è¢«è¦†ç›–ï¼‰
```

## å…«ã€å®é™…é¡¹ç›®å®ç° ##

### é¡¹ç›®èƒŒæ™¯ï¼šè´­ç‰©åº”ç”¨è·¨æ ‡ç­¾é¡µåŒæ­¥ ###

ç”¨æˆ·åœ¨è´­ç‰©åº”ç”¨ä¸­ï¼ŒåŒæ—¶æ‰“å¼€äº†ä¸¤ä¸ªæ ‡ç­¾é¡µï¼š

- æ ‡ç­¾é¡µ Aï¼šè´­ç‰©è½¦é¡µé¢ï¼ˆcart.vueï¼‰
- æ ‡ç­¾é¡µ Bï¼šå•†å“è¯¦æƒ…é¡µé¢ï¼ˆproductDetail.vueï¼‰

**éœ€æ±‚**ï¼š

- åœ¨æ ‡ç­¾é¡µ A ä¿®æ”¹å•†å“æ•°é‡ï¼Œæ ‡ç­¾é¡µ B è‡ªåŠ¨æ›´æ–°å¯¹åº”å•†å“ä¿¡æ¯
- åœ¨æ ‡ç­¾é¡µ B åŠ å…¥è´­ç‰©è½¦ï¼Œæ ‡ç­¾é¡µ A çš„è´­ç‰©è½¦æ•°æ®å®æ—¶åˆ·æ–°
- é¡µé¢åˆ·æ–°åä»èƒ½ä¿æŒæ•°æ®åŒæ­¥

### å‘é€ç«¯å®ç° (cart.vue) ###

```vue:cart.vue
<script setup>
import { onMounted, onUnmounted } from 'vue';

// åˆ›å»ºå¹¿æ’­é€šé“
const syncChannel = new BroadcastChannel('shopping_sync_channel');

onMounted(() => {
  getCartList();
});

onUnmounted(() => {
  // ç»„ä»¶å¸è½½æ—¶å…³é—­é€šé“ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
  syncChannel.close();
});

// è·å–è´­ç‰©è½¦åˆ—è¡¨
async function getCartList() {
  const res = await fetchCartItems();
  state.cartItems = res.data || [];
}

// ç”¨æˆ·ä¿®æ”¹è´­ç‰©è½¦ä¸­å•†å“çš„æ•°é‡
function updateItemQuantity(item, newQuantity) {
  // 1. æ›´æ–°æœ¬åœ°æ•°æ®
  item.quantity = newQuantity;
  updateCart(item);
  
  // 2. âœ¨ å‘é€åŒæ­¥æ¶ˆæ¯ç»™å…¶ä»–æ ‡ç­¾é¡µ
  syncChannel.postMessage({
    type: 'CART_UPDATED',
    productId: item.productId,
    productName: item.productName,
    quantity: newQuantity,
    price: item.price,
    timestamp: Date.now(),
  });
}

// ç”¨æˆ·æ¸…ç©ºè´­ç‰©è½¦
function clearCart() {
  state.cartItems = [];
  clearCartAPI();
  
  // âœ¨ é€šçŸ¥å…¶ä»–æ ‡ç­¾é¡µè´­ç‰©è½¦å·²æ¸…ç©º
  syncChannel.postMessage({
    type: 'CART_CLEARED',
    timestamp: Date.now(),
  });
}
</script>
```

### æ¥æ”¶ç«¯å®ç° (productDetail.vue) ###

```vue:productDetail.vue
<script setup>
import { onMounted, onUnmounted } from 'vue';

const router = useRouter();
const routes = useRoute();

// åˆ›å»ºåŒåå¹¿æ’­é€šé“
const syncChannel = new BroadcastChannel('shopping_sync_channel');

onMounted(() => {
  // åˆå§‹åŠ è½½å•†å“è¯¦æƒ…
  if (routes.query.productId) {
    loadProductDetail(routes.query.productId);
  }
  
  // âœ¨ ç›‘å¬è´­ç‰©è½¦åŒæ­¥æ¶ˆæ¯
  syncChannel.onmessage = (event) => {
    const { type, productId, quantity, timestamp } = event.data;
    
    if (type === 'CART_UPDATED') {
      // 1. æ›´æ–° URL æŸ¥è¯¢å‚æ•°ï¼ˆç¡®ä¿åˆ·æ–°åæ•°æ®ä¸€è‡´ï¼‰
      router.replace({
        path: routes.path,
        query: {
          ...routes.query,
          productId,
          lastUpdate: timestamp,
        },
      });
      
      // 2. é‡æ–°åŠ è½½å•†å“æ•°æ®
      loadProductDetail(productId);
      
      // 3. æ˜¾ç¤ºåŒæ­¥æç¤º
      proxy.$message.info(`è´­ç‰©è½¦å·²æ›´æ–°ï¼š${productId} çš„æ•°é‡å˜ä¸º ${quantity}`);
    } 
    else if (type === 'CART_CLEARED') {
      // è´­ç‰©è½¦è¢«æ¸…ç©ºï¼Œæ›´æ–°UIæ˜¾ç¤º
      updateCartStatus('empty');
      proxy.$message.warning('è´­ç‰©è½¦å·²åœ¨å…¶ä»–æ ‡ç­¾é¡µè¢«æ¸…ç©º');
    }
  };
});

onUnmounted(() => {
  // å…³é—­é€šé“ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
  syncChannel.close();
});

// åŠ è½½å•†å“è¯¦æƒ…
const loadProductDetail = (productId) => {
  fetchProductDetail(productId).then((res) => {
    state.product = res.data;
    state.productId = productId;
  });
};

// æ›´æ–°è´­ç‰©è½¦çŠ¶æ€æ˜¾ç¤º
const updateCartStatus = (status) => {
  state.cartStatus = status;
};
</script>
```

### æ ¸å¿ƒæµç¨‹ ###

```txt
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   cart.vue (æ ‡ç­¾é¡µ A)               â”‚
â”‚ ç”¨æˆ·ä¿®æ”¹è´­ç‰©è½¦å•†å“æ•°é‡             â”‚
â”‚         â†“                           â”‚
â”‚ updateItemQuantity(item) æ›´æ–°æœ¬åœ°  â”‚
â”‚         â†“                           â”‚
â”‚ ğŸ›’ syncChannel.postMessage()       â”‚
â”‚    å‘é€ {productId, quantity, ...} â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ BroadcastChannel
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ productDetail.vue (æ ‡ç­¾é¡µ B)        â”‚
â”‚                                     â”‚
â”‚ syncChannel.onmessage è§¦å‘          â”‚
â”‚         â†“                           â”‚
â”‚ ğŸ“ router.replace() æ›´æ–° URL       â”‚
â”‚         â†“                           â”‚
â”‚ ğŸ”„ loadProductDetail() é‡æ–°åŠ è½½    â”‚
â”‚         â†“                           â”‚
â”‚ âœ… ä¸¤ä¸ªæ ‡ç­¾é¡µè´­ç‰©æ•°æ®å®Œå…¨åŒæ­¥      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä¹ã€å…³é”®è®¾è®¡ç‚¹ ##

### é€šé“åç§°ç®¡ç† ###

```javascript
// âœ… æ¨èï¼šä½¿ç”¨æ˜ç¡®çš„å‘½åè§„èŒƒ
const CHANNEL_NAMES = {
  SHOPPING_SYNC: 'shopping_sync_channel',
  USER_PROFILE: 'user_profile_sync',
  NOTIFICATION_UPDATE: 'notification_update',
  DATA_DASHBOARD: 'data_dashboard_sync',
};

const channel = new BroadcastChannel(CHANNEL_NAMES.SHOPPING_SYNC);
```

### ç”Ÿå‘½å‘¨æœŸç®¡ç† ###

```javascript
onMounted(() => {
  channel = new BroadcastChannel('sync_channel');
  channel.onmessage = handleMessage;
});

onUnmounted(() => {
  // âœ… å¿…é¡»å…³é—­ï¼Œå¦åˆ™ä¼šæ³„æ¼å†…å­˜
  channel.close();
  channel = null;
});
```

### URL åŒæ­¥æœºåˆ¶ ###

```javascript
// âœ… ä½¿ç”¨ router.replace() è€Œé push()
// è¿™æ ·åˆ·æ–°åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„çŠ¶æ€
router.replace({
  path: routes.path,
  query: {
    ...routes.query,
    deviceId,
  },
});
```

### æ¶ˆæ¯ä½“è®¾è®¡ ###

```javascript
// âœ… åªä¼ é€’å¿…è¦æ•°æ®ï¼Œå‡å°‘åºåˆ—åŒ–å¼€é”€
syncChannel.postMessage({
  type: 'CART_UPDATED',
  productId: item.productId,
  quantity: newQuantity,
  price: item.price,
  timestamp: Date.now(),
});

// âŒ é¿å…ï¼šä¼ é€’æ•´ä¸ªå•†å“å¯¹è±¡ï¼ˆåŒ…å«æ— å…³ä¿¡æ¯ï¼‰
// syncChannel.postMessage(item);
```

### å®‰å…¨è€ƒè™‘ ###

```javascript
// BroadcastChannel ä»…æ”¯æŒåŒæºé€šä¿¡
// æµè§ˆå™¨è‡ªåŠ¨è§„é¿å®‰å…¨éšæ‚£ï¼Œæ— éœ€æ‰‹åŠ¨æ£€æŸ¥
// ä¸åŒæºçš„é¡µé¢æ— æ³•è®¿é—®è¯¥é€šé“

// å¦‚æœéœ€è¦è·¨æºï¼Œä½¿ç”¨ postMessageï¼š
if (event.origin !== window.location.origin) return;
```

## åã€æµè§ˆå™¨å…¼å®¹æ€§ ##

| **æµè§ˆå™¨**        |      **postMessage**      | **MessageChannel**        |      **BroadcastChannel**      |      **Storage**      |
| :------------- | :-----------: | :------------- | :-----------: | :------------- |
|  Chrome  | âœ… å…¨ç‰ˆæœ¬  |  âœ… å…¨ç‰ˆæœ¬  | âœ… 54+  |  âœ… å…¨ç‰ˆæœ¬  |
|  Firefox  | âœ… å…¨ç‰ˆæœ¬  |  âœ… å…¨ç‰ˆæœ¬  | âœ… 38+  |  âœ… å…¨ç‰ˆæœ¬  |
|  Safari  | âœ… å…¨ç‰ˆæœ¬  |  âœ… å…¨ç‰ˆæœ¬  | âœ… 15.1+  |  âœ… å…¨ç‰ˆæœ¬  |
|  Edge  | âœ… å…¨ç‰ˆæœ¬  |  âœ… å…¨ç‰ˆæœ¬  | âœ… 79+  |  âœ… å…¨ç‰ˆæœ¬  |
|  IE  | âœ… 11+  |  âœ… 11+  | âŒ ä¸æ”¯æŒ  |  âœ… 8+  |

### å¤„ç†å…¼å®¹æ€§ ###

```javascript
// æ£€æµ‹ BroadcastChannel æ”¯æŒ
if (typeof BroadcastChannel !== 'undefined') {
  // ä½¿ç”¨ BroadcastChannel
  const channel = new BroadcastChannel('sync');
} else {
  // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ postMessage æˆ– localStorage
  console.warn('æµè§ˆå™¨ä¸æ”¯æŒ BroadcastChannelï¼Œä½¿ç”¨é™çº§æ–¹æ¡ˆ');
}
```

## åä¸€ã€æœ€ç»ˆå†³ç­–æŒ‡å— ##

### é€‰æ‹©æ ‡å‡†ä¸å†³ç­–æ ‘ ###

```txt
éœ€è¦è·¨æ ‡ç­¾é¡µé€šä¿¡å—ï¼Ÿ
  â”œâ”€ ä¸éœ€è¦ â†’ ä½¿ç”¨æœ¬åœ° Vue çŠ¶æ€ç®¡ç†
  â””â”€ éœ€è¦
      â”œâ”€ éœ€è¦è·¨æºå—ï¼Ÿ
      â”‚   â”œâ”€ æ˜¯ â†’ ä½¿ç”¨ postMessage æˆ– MessageChannel
      â”‚   â””â”€ å¦
      â”‚       â”œâ”€ éœ€è¦å®æ—¶é€šä¿¡å—ï¼Ÿ
      â”‚       â”‚   â”œâ”€ æ˜¯ â†’ ğŸ¯ ä½¿ç”¨ BroadcastChannel
      â”‚       â”‚   â””â”€ å¦
      â”‚       â”‚       â”œâ”€ éœ€è¦æ•°æ®æŒä¹…åŒ–å—ï¼Ÿ
      â”‚       â”‚       â”‚   â”œâ”€ æ˜¯ â†’ localStorage + BroadcastChannel
      â”‚       â”‚       â”‚   â””â”€ å¦ â†’ sessionStorage + è½®è¯¢ï¼ˆä¸æ¨èï¼‰
```

### æ¨èæ–¹æ¡ˆæ±‡æ€» ###

| **åœºæ™¯**   |   **æ¨èæ–¹æ¡ˆ**      |   **ç†ç”±**      |
| :------------- | :-----------: |   **è¯´æ˜**      |
|  å®æ—¶åŒæ­¥ï¼ˆåŒæºï¼‰  | ğŸ¯ BroadcastChannel  | ç®€æ´ã€é«˜æ•ˆã€æ— éœ€è½®è¯¢  |
|  æ•°æ®æŒä¹…åŒ–+å®æ—¶åŒæ­¥  | localStorage + BroadcastChannel  | æ•°æ®æŒä¹… + å®æ—¶é€šçŸ¥  |
|  è·¨æºé€šä¿¡  | postMessage  | å”¯ä¸€æ”¯æŒè·¨æºçš„æ–¹æ¡ˆ  |
|  ç‚¹å¯¹ç‚¹å¯é é€šä¿¡  | MessageChannel  | åŒå‘å¯é é€šé“  |
|  æµè§ˆå™¨å…¼å®¹æ€§æœ€é«˜  | postMessage  | æœ€å¹¿æ³›çš„æµè§ˆå™¨æ”¯æŒ  |
|  ä¸æ¨è  | âŒ Storage ä½œæ¶ˆæ¯é˜Ÿåˆ—  | éœ€è½®è¯¢ã€æ˜“ä¸¢å¤±ã€éš¾ç»´æŠ¤  |

### æœ€ä½³å®è·µæ¸…å• ###

- âœ… ä¼˜å…ˆé€‰æ‹© BroadcastChannelï¼ˆåœ¨åŒæºåœºæ™¯ä¸‹ï¼‰
- âœ… ä½¿ç”¨æ˜ç¡®çš„é€šé“å‘½åï¼ˆé¿å…å†²çªï¼‰
- âœ… æ€»æ˜¯åœ¨ç»„ä»¶å¸è½½æ—¶å…³é—­é€šé“ï¼ˆé˜²æ­¢å†…å­˜æ³„æ¼ï¼‰
- âœ… ä½¿ç”¨ router.replace åŒæ­¥ URLï¼ˆç¡®ä¿åˆ·æ–°åçŠ¶æ€ä¸€è‡´ï¼‰
- âœ… åªä¼ é€’å¿…è¦çš„æ•°æ®ï¼ˆå‡å°‘åºåˆ—åŒ–å¼€é”€ï¼‰
- âœ… æä¾›é™çº§æ–¹æ¡ˆï¼ˆè€ƒè™‘æ—§æµè§ˆå™¨å…¼å®¹æ€§ï¼‰
- âŒ ä¸è¦ç”¨ Storage ä½œæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆè¿™æ˜¯å¯¹ API çš„è¯¯ç”¨ï¼‰

## åäºŒã€å¸¸è§é—®é¢˜ FAQ ##

### Q1: ä¸ºä»€ä¹ˆ BroadcastChannel æ”¶ä¸åˆ°æ¶ˆæ¯ï¼Ÿ ###

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š

- âœ… é€šé“åç§°æ˜¯å¦ä¸€è‡´
- âœ… æ˜¯å¦ä¸ºåŒæºé¡µé¢ï¼ˆåè®®ã€åŸŸåã€ç«¯å£éƒ½è¦ç›¸åŒï¼‰
- âœ… æ˜¯å¦è°ƒç”¨äº† channel.close()
- âœ… æ¶ˆæ¯æ˜¯å¦å‘é€åœ¨ç›‘å¬å™¨åˆ›å»ºä¹‹å

### Q2: ä¸ºä»€ä¹ˆä¸ç”¨ Storage ä½œæ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ ###

A: å› ä¸º Storage çš„è®¾è®¡æœ¬å°±ä¸æ˜¯ä¸ºäº†æ¶ˆæ¯é€šä¿¡ï¼š

- âŒ åŒä¸€æ ‡ç­¾é¡µä¿®æ”¹æ— æ³•è§¦å‘äº‹ä»¶
- âŒ æ¶ˆæ¯ä¼šè¢«åç»­æ¶ˆæ¯è¦†ç›–
- âŒ éœ€è¦è½®è¯¢ï¼Œå»¶è¿Ÿå¤§
- âŒ éœ€è¦ç‰ˆæœ¬å·/æ—¶é—´æˆ³ç­‰å¤æ‚æœºåˆ¶
- âŒ æ¶ˆæ¯å¯é æ€§ä½

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ BroadcastChannel è¢«è®¾è®¡å‡ºæ¥çš„åŸå› ã€‚

### Q3: localStorage å¯ä»¥ç”¨äºè·¨æ ‡ç­¾é¡µé€šä¿¡å—ï¼Ÿ ###

A: å¯ä»¥ï¼Œä½†ä¸æ¨èä½œä¸ºä¸»è¦é€šä¿¡æœºåˆ¶ï¼š

- âš ï¸ éœ€è¦è½®è¯¢æˆ–å®šæ—¶æ£€æŸ¥
- âš ï¸ å»¶è¿Ÿå¤§ï¼ˆé€šå¸¸ 100ms+ï¼‰
- âš ï¸ æ¶ˆæ¯æ˜“ä¸¢å¤±ï¼ˆè¢«æ–°æ¶ˆæ¯è¦†ç›–ï¼‰

é€‚ç”¨åœºæ™¯ï¼š

- éœ€è¦æ•°æ®æŒä¹…åŒ–æ—¶ï¼Œé…åˆ BroadcastChannel ä½¿ç”¨
- ç¦»çº¿æ•°æ®åŒæ­¥æ—¶
- è·¨ä¼šè¯æ•°æ®æ¢å¤æ—¶

### Q4: å¦‚ä½•å®ç°è·¨æºé€šä¿¡ï¼Ÿ ###

A: ä½¿ç”¨ postMessage æˆ– MessageChannelï¼Œä½†è¦æ³¨æ„å®‰å…¨æ€§ï¼š

```javascript
// postMessage è·¨æºé€šä¿¡
newWindow.postMessage(data, 'https://trusted-domain.com');

// æ¥æ”¶ç«¯å¿…é¡»éªŒè¯æ¥æº
window.addEventListener('message', (event) => {
  if (event.origin !== 'https://trusted-domain.com') return;
  // å®‰å…¨å¤„ç†æ¶ˆæ¯
});
```

### Q5: BroadcastChannel ä¸­çš„é”™è¯¯å¦‚ä½•å¤„ç†ï¼Ÿ ###

A: ç›‘å¬ messageerror äº‹ä»¶ï¼š

```javascript
channel.onmessageerror = (event) => {
  console.error('æ¶ˆæ¯è§£æé”™è¯¯:', event);
};

// æˆ–ä½¿ç”¨ addEventListener
channel.addEventListener('messageerror', (event) => {
  console.error('æ¶ˆæ¯é”™è¯¯:', event);
});
```

## åä¸‰ã€åº”ç”¨åœºæ™¯æ‹“å±• ##

BroadcastChannel çš„åº”ç”¨è¿œä¸æ­¢è·¨æ ‡ç­¾é¡µæ•°æ®åŒæ­¥ï¼Œè¿˜åŒ…æ‹¬ï¼š

### åœºæ™¯ 1ï¼šç”µå•†åº“å­˜å®æ—¶åŒæ­¥ ###

```javascript
// å¤šä¸ªé—¨åº—ç³»ç»Ÿæ ‡ç­¾é¡µåŒæ—¶æ‰“å¼€
const inventoryChannel = new BroadcastChannel('inventory_sync');

// é—¨åº— A åœ¨æ ‡ç­¾é¡µ 1 æ‰«æå•†å“å…¥åº“
inventoryChannel.postMessage({
  type: 'STOCK_IN',
  productId: 'SKU-123',
  quantity: 50,
  location: 'warehouse-1',
  timestamp: Date.now(),
});

// é—¨åº— B åœ¨æ ‡ç­¾é¡µ 2 è‡ªåŠ¨æ”¶åˆ°æ›´æ–°
inventoryChannel.onmessage = (event) => {
  if (event.data.type === 'STOCK_IN') {
    updateInventory(event.data);
    showNotification(`åº“å­˜å·²æ›´æ–°ï¼š${event.data.quantity}ä»¶`);
  }
};
```

### åœºæ™¯ 2ï¼šè®¢å•çŠ¶æ€å®æ—¶åŒæ­¥ ###

```javascript
const orderChannel = new BroadcastChannel('order_sync');

// åå°ç®¡ç†é¡µé¢åœ¨æ ‡ç­¾é¡µ 1 æ›´æ–°è®¢å•çŠ¶æ€
orderChannel.postMessage({
  orderId: 'ORD-2024-001',
  status: 'shipped',
  trackingNo: 'TRK123456',
  updatedAt: Date.now(),
});

// å®¢æœé¡µé¢åœ¨æ ‡ç­¾é¡µ 2 è‡ªåŠ¨è·å–æœ€æ–°çŠ¶æ€
orderChannel.onmessage = (event) => {
  updateOrderUI(event.data);
  notifyCustomer(`è®¢å• ${event.data.orderId} å·²${event.data.status}`);
};
```

### åœºæ™¯ 3ï¼šç”¨æˆ·è´¦æˆ·è®¾ç½®å®æ—¶åŒæ­¥ ###

```javascript
const userSettingsChannel = new BroadcastChannel('user_settings_sync');

// ç”¨æˆ·åœ¨è´¦æˆ·è®¾ç½®é¡µé¢ï¼ˆæ ‡ç­¾é¡µ 1ï¼‰ä¿®æ”¹ä¸»é¢˜
userSettingsChannel.postMessage({
  type: 'THEME_CHANGED',
  theme: 'dark',
  userId: '12345',
});

// æ‰€æœ‰æ‰“å¼€çš„åº”ç”¨é¡µé¢ï¼ˆæ ‡ç­¾é¡µ 2ã€3ã€4...ï¼‰è‡ªåŠ¨åŒæ­¥
userSettingsChannel.onmessage = (event) => {
  if (event.data.type === 'THEME_CHANGED') {
    applyTheme(event.data.theme);
    showMessage('ä¸»é¢˜å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼');
  }
};
```

### åœºæ™¯ 4ï¼šå®æ—¶æ•°æ®ä»ªè¡¨æ¿ ###

```javascript
const dashboardChannel = new BroadcastChannel('analytics_dashboard');

// æ•°æ®åˆ†æå·¥å…·åœ¨åå°æ”¶é›†æ•°æ®ï¼ˆæ ‡ç­¾é¡µ 1ï¼‰
dashboardChannel.postMessage({
  metric: 'daily_sales',
  value: 15000,
  region: 'east',
  timestamp: Date.now(),
});

// å¤šä¸ªä»ªè¡¨æ¿è§†å›¾ï¼ˆæ ‡ç­¾é¡µ 2ã€3ã€4...ï¼‰è‡ªåŠ¨åˆ·æ–°
dashboardChannel.onmessage = (event) => {
  updateChart(event.data);
  updateDataCard(event.data);
  playNotificationSound(); // æ–°æ•°æ®åˆ°è¾¾æ—¶æé†’
};
```

## ç»“è¯­ ##

BroadcastChannel ä»£è¡¨äº†ç°ä»£ Web åº”ç”¨é€šä¿¡çš„æœ€ä½³å®è·µâ€”â€”*ç®€æ´ã€é«˜æ•ˆã€æ˜“ç»´æŠ¤*ã€‚

é€šè¿‡å……åˆ†ç†è§£äº”ç§è·¨çª—å£é€šä¿¡æ–¹æ¡ˆçš„ä¼˜åŠ£ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨å®é™…é¡¹ç›®ä¸­åšå‡ºæœ€åˆç†çš„æŠ€æœ¯é€‰æ‹©ã€‚æ­£ç¡®çš„é€šä¿¡æœºåˆ¶æ˜¯ç³»ç»Ÿå¯é æ€§çš„åŸºçŸ³ã€‚

**å…³é”®è¦ç‚¹**ï¼š

- ğŸ¯ åŒæºåœºæ™¯ä¸‹ï¼ŒBroadcastChannel æ˜¯é¦–é€‰
- ğŸ“Š Storage ç”¨äºæŒä¹…åŒ–ï¼Œä¸ç”¨äºæ¶ˆæ¯é€šä¿¡
- âœ… æ€»æ˜¯è®°å¾—å…³é—­é€šé“ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
- ğŸ”„ URL åŒæ­¥ç¡®ä¿åˆ·æ–°åçŠ¶æ€ä¸€è‡´
- ğŸš€ ç®€å•åœºæ™¯ä¹Ÿèƒ½åšåˆ°ä¼˜é›…å®ç°

## é™„å½•ï¼šæŠ€æœ¯å¯¹æ¯”é€ŸæŸ¥è¡¨ ##

### äº”ç§æ–¹æ¡ˆå¯¹æ¯”ä¸€è§ˆè¡¨ ###

| **ç»´åº¦**        |      **postMessage**      | **MessageChannel**        |      **BroadcastChannel**      |      **sessionStorage**      |      **localStorage**      |
| :------------- | :-----------: | :------------- | :-----------: | :------------- | :------------- |
|  ä»£ç è¡Œæ•°  | 20-30  |  40-50  | 10-15  |  30-40  |  30-40  |
|  å­¦ä¹ éš¾åº¦  | ä½  |  é«˜  | ä½  |  ä½  |  ä½  |
|  å®æ—¶æ€§  | ms çº§  |  ms çº§  | ms çº§  |  ç§’çº§+  |  ç§’çº§+  |
|  å¯é æ€§  | é«˜  |  é«˜  | é«˜  |  ä½  |  ä½  |
|  å†…å­˜æ•ˆç‡  | å¥½  |  ä¸­  | å¥½  |  å·®  |  å·®  |
|  æ¶ˆæ¯ä¸¢å¤±ç‡  | 0%  |  0%  | 0%  |  10%+  |  10%+  |
|  æ€§èƒ½è¯„åˆ†  | â­â­â­â­  |  â­â­â­  | â­â­â­â­â­  |  â­  |  â­  |
|  ç»¼åˆè¯„åˆ†  | â­â­â­  |  â­â­  | â­â­â­â­â­  |  â­  |  â­  |

### å®ç°ä»£ç å¯¹æ¯” ###

**BroadcastChannelï¼ˆ3 è¡Œï¼‰**

```javascript
const ch = new BroadcastChannel('sync');
ch.postMessage(data);
ch.onmessage = (e) => handle(e.data);
```

**sessionStorageï¼ˆ15+ è¡Œï¼‰**

```javascript
const queue = new StorageMessageQueue('sync');
queue.send(data);
queue.onMessage(handle);
```

**postMessageï¼ˆ25+ è¡Œï¼‰**

```javascript
const win = window.open(url);
win.postMessage(data, '*');
window.addEventListener('message', (e) => handle(e.data));
```
