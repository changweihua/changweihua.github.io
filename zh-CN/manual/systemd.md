---
outline: false
aside: false
layout: doc
date: 2025-03
title: systemdå®šæ—¶å™¨
description: systemdå®šæ—¶å™¨
category: å·¥å…·
pageClass: manual-page-class
---

åœ¨è¿™ç¯‡æ”»ç•¥ä¸­ï¼Œä½ ä¼šå­¦åˆ°å¦‚ä½•ä½¿ç”¨systemdå®šæ—¶å™¨ã€æ¢ç´¢å®ƒä»¬çš„æ ¼å¼ï¼Œå¹¶çœ‹åˆ°ä¸€äº›å®ç”¨çš„ä¾‹å­å’Œç”¨ä¾‹ã€‚åˆ°æ–‡ç« ç»“æŸæ—¶ï¼Œä½ å°†å¯¹å¦‚ä½•ä½¿ç”¨systemdå®šæ—¶å™¨æœ‰äº†æ‰å®çš„ç†è§£ã€‚

##  ä»€ä¹ˆæ˜¯systemdå®šæ—¶å™¨ï¼Ÿ ##

ä¸€ä¸ªsystemdå®šæ—¶å™¨å°±æ˜¯ç”¨æ¥å®‰æ’åœ¨ç‰¹å®šæ—¶é—´æˆ–é—´éš”å†…æ‰§è¡Œä»»åŠ¡æˆ–æœåŠ¡çš„ä¸€ä¸ªå•å…ƒæ–‡ä»¶ã€‚å®ƒç±»ä¼¼äºcronä½œä¸šï¼Œä½†æ‹¥æœ‰æ›´å¤šçš„ç‰¹æ€§ï¼Œå¹¶ä¸”ä¸systemdç”Ÿæ€ç³»ç»Ÿæœ‰æ›´å¥½çš„é›†æˆã€‚

ç›¸æ¯”äºcronï¼Œsystemdå®šæ—¶å™¨å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š

- æ›´å¥½åœ°é›†ä¸­ç®¡ç†ï¼ˆé€šè¿‡systemctlï¼‰ä»¥æä¾›æ›´å¥½çš„æ—¥å¿—è®°å½•å’Œé”™è¯¯è·Ÿè¸ªã€‚
- ä¸systemdæœåŠ¡æ›´æ·±å±‚æ¬¡çš„æ•´åˆã€‚
- è¯¦ç»†çš„æ—¥å¿—è®°å½•åŠŸèƒ½journalctlã€‚
- æ›´çµæ´»ã€å¼ºå¤§çš„è°ƒåº¦é€‰é¡¹ã€‚

é»˜è®¤æƒ…å†µä¸‹ä½ çš„ç³»ç»Ÿä¸­å·²ç»è¿è¡Œäº†ä¸€äº›å®šæ—¶å™¨ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™æ¡å‘½ä»¤åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„å®šæ—¶å™¨ï¼š

```bash
systemctl list-timers --all
```

ä¾‹å¦‚ï¼Œsystemd-tmpfiles-clean.timerä¼šæ ¹æ®tmpfiles.då®šä¹‰çš„è§„åˆ™ï¼Œåœ¨ä¸´æ—¶ç›®å½•ï¼ˆå¦‚/tmpå’Œ/var/tmpï¼‰ä¸­æ¸…é™¤è¿‡æœŸæ–‡ä»¶ã€‚

## systemd å®šæ—¶å™¨çš„å·¥ä½œåŸç†ï¼Ÿ ##

ä¸ä½¿ç”¨å•ä¸€æ–‡ä»¶å®‰æ’ä»»åŠ¡çš„cronä¸åŒï¼Œsystemdå®šæ—¶å™¨ä½¿ç”¨ä¸¤ä¸ªå…³é”®æ–‡ä»¶ï¼šæœåŠ¡å’ŒæœåŠ¡å®šæ—¶å™¨æ–‡ä»¶ã€‚

- å®šæ—¶å™¨æ–‡ä»¶ï¼šæŒ‡å®šä»»åŠ¡ä½•æ—¶æ‰§è¡Œï¼ˆä¾‹å¦‚ï¼Œæ¯å¤©ã€æ¯å‘¨æˆ–ç‰¹å®šæ—¶é—´ç‚¹ï¼‰ã€‚
- æœåŠ¡æ–‡ä»¶ï¼šå®šä¹‰ä»»åŠ¡çš„å…·ä½“å†…å®¹ï¼ˆè¦è¿è¡Œçš„è„šæœ¬æˆ–å‘½ä»¤ï¼‰ã€‚

å®šæ—¶å™¨æ–‡ä»¶ä¸æœåŠ¡æ–‡ä»¶æ˜¯å…³è”åœ¨ä¸€èµ·çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®šæ—¶å™¨å†³å®šè°ƒåº¦å®‰æ’ï¼Œè€ŒæœåŠ¡å¤„ç†å®é™…çš„å·¥ä½œã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ æƒ³æ¯å¤©éƒ½æ‰§è¡Œä¸€ä¸ªå¤‡ä»½è„šæœ¬ï¼š

1. åˆ›å»ºä¸€ä¸ªæœåŠ¡æ–‡ä»¶æ¥å®šä¹‰å°†è¢«æ‰§è¡Œçš„è„šæœ¬ã€‚
2. åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨æ–‡ä»¶è®¾ç½®è¯¥æœåŠ¡çš„è¿è¡Œæ—¶é—´è¡¨ï¼ˆä¾‹å¦‚æ¯å¤©åˆå¤œï¼‰ã€‚
3. ä½ å¯ä»¥åƒç®¡ç†å…¶ä»–æœåŠ¡ä¸€æ ·æ§åˆ¶è¿™äº›å®šæ—¶å™¨ã€‚ä½¿ç”¨å‘½ä»¤å¦‚ `systemctl start`, `systemctl stop`, `systemctl enable` æˆ– `systemctl status`æ¥æ“ä½œå®ƒä»¬ã€‚

```ini
# ç¤ºä¾‹ï¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„å®šæ—¶å™¨æ–‡ä»¶ daily-backup.timer
[Unit]
Description=Daily Backup Timer

[Timer]
OnCalendar=daily
Persistent=true
Unit=daily-backup.service

[Install]
WantedBy=timers.target
```

```ini
# å¯¹åº”çš„æœåŠ¡æ–‡ä»¶ daily-backup.service
[Unit]
Description=Run Daily Backup Script

[Service]
ExecStart=/usr/local/bin/backup.sh
```

ç°åœ¨ä½ å·²ç»çŸ¥é“systemdå®šæ—¶å™¨çš„åŸç†å’ŒåŸºæœ¬ç”¨æ³•äº†ï¼Œå¿«å»å®è·µä¸€ä¸‹å§ï¼

## ç†è§£ Systemd å®šæ—¶å™¨è¡¨è¾¾å¼ ##

å¤§å®¶å¥½ï¼Œä»Šå¤©æˆ‘ä»¬æ¥èŠèŠ Systemd çš„å®šæ—¶å™¨ï¼ˆTimerï¼‰é…ç½®ã€‚ä¸è¦å®³æ€•ï¼Œè¿™å…¶å®æŒºå¥½ç©çš„ï¼å…ˆæ¥çœ‹çœ‹åŸºæœ¬è¯­æ³•ï¼š

```bash
* *-*-* *:*:*
```

è¿™é‡Œæœ‰ä¸€ä¸ªè¶…çº§é‡è¦çš„ç§˜å¯†ï¼šâ€œ*â€ è¡¨ç¤ºæ¯â€¦â€¦ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœä½ å†™æˆ `* *-*-* *:*:*` ï¼Œé‚£å°±æ„å‘³ç€å®ƒä¼šæ¯ä¸€ç§’éƒ½è¿è¡Œä¸€æ¬¡ç›´åˆ°ä½ åœæ­¢å®ƒï¼ˆå“ˆå“ˆï¼Œè¿™å¯èƒ½æœ‰ç‚¹ç–¯ç‹‚ï¼‰ã€‚

å…·ä½“æ¥è¯´ï¼š

- ç¬¬ä¸€ä¸ªâ€œ*â€ä»£è¡¨ä¸€å‘¨ä¸­çš„æ¯ä¸€å¤©ï¼Œä»å‘¨æ—¥åˆ°å‘¨å…­ã€‚
- â€œ*--â€è¡¨ç¤ºæ—¥æœŸå¹´æœˆæ—¥ã€‚
- â€œ*:**:â€è¡¨ç¤ºæ—¶é—´å°æ—¶åˆ†é’Ÿç§’ã€‚

### ç†è§£ Systemd å®šæ—¶å™¨è§¦å‘ ###

Systemd å®šæ—¶å™¨æä¾›äº†å¾ˆå¤šé…·ç‚«çš„è°ƒåº¦é€‰é¡¹æ¥å®šä¹‰ä»€ä¹ˆæ—¶å€™æ‰§è¡Œä»»åŠ¡ã€‚è®©æˆ‘ä»¬è½»æ¾ä¸€ä¸‹ï¼š

### æ—¶é—´åŸºè§¦å‘ ###

è¿™äº›ç›¸å¯¹å®šæ—¶å™¨ä»ç‰¹å®šäº‹ä»¶å¼€å§‹è®¡æ•°ã€‚å®ƒä»¬ä½¿ç”¨ `OnActiveSec`, `OnBootSec`, `OnStartupSec`, `OnUnitActiveSec` å’Œ `OnUnitInactiveSec` é€‰é¡¹ã€‚

ä¸¾å‡ ä¸ªä¾‹å­å§ï¼š

- `OnBootSec=1h` ï¼šåœ¨ç³»ç»Ÿå¯åŠ¨åä¸€å°æ—¶è¿è¡Œã€‚
- `OnUnitActiveSec=1d` ï¼šæœåŠ¡ä¸Šæ¬¡æ¿€æ´»åä¸€å¤©è¿è¡Œã€‚
- `OnActiveSec=30min` ï¼šå®šæ—¶å™¨è‡ªèº«æ¿€æ´»ååŠå°æ—¶è¿è¡Œã€‚

### æ—¥å†åŸºè§¦å‘ ###

è¿™äº›åŸºäºé¢„å®šä¹‰æ—¥æœŸæˆ–å‘¨æœŸæ€§æ—¶é—´è¡¨ï¼Œæ¯”å¦‚æ¯å¤©åˆå¤œã€æ¯å‘¨ä¸€æ—©ä¸Šä¹ç‚¹ï¼Œç”šè‡³æ¯æœˆç¬¬ä¸€å¤©ã€‚å®Œç¾é€‚åˆé‚£äº›éœ€è¦éµå¾ªå›ºå®šæ—¶é—´è¡¨çš„ä»»åŠ¡ã€‚

ä¸¾å‡ ä¸ªä¾‹å­å§ï¼š

- `OnCalendar=Mon,Thu --* 16:00:00` ï¼šæ¯å‘¨ä¸€å’Œå‘¨å››ä¸‹åˆå››ç‚¹é’Ÿè¿è¡Œã€‚
- `OnCalendar=--* *:00:00` ï¼šæ¯å°æ—¶å¼€å§‹æ—¶è¿è¡Œã€‚
- `OnCalendar=--* 9..17:00:00` ï¼šä»æ—©ä¸Šä¹ç‚¹åˆ°äº”ç‚¹ï¼Œæ¯éš”ä¸€ä¸ªå°æ—¶è¿è¡Œã€‚

ç¤ºä¾‹åˆ—è¡¨

| å®šä¹‰ | Systemd å®šæ—¶å™¨ç­‰ä»· | æè¿° |
| :---: | :----: | :---: |
| ç³»ç»Ÿå¯åŠ¨å | OnBootSec=30s | å¯åŠ¨å 30 ç§’è¿è¡Œ |
| æ¯å¹´ä¸€æ¬¡ | OnCalendar=*-1-1 | æ¯å¹´ä¸€æœˆä¸€æ—¥ |
| æ¯å­£åº¦ä¸€æ¬¡ | OnCalendar=quarterly | æ¯ä¸‰ä¸ªæœˆä¸€æ¬¡ |
| æ¯æœˆä¸€æ¬¡ | OnCalendar=*-*-1 | æ¯ä¸ªæœˆçš„ç¬¬ä¸€å¤© |
| æ¯å‘¨ä¸€æ¬¡ | OnCalendar=Sun | æ¯å‘¨æ—¥ |
| æ¯æ—¥ä¸€æ¬¡ | OnCalendar=*-*-* 00:00:00 | æ¯å¤©åˆå¤œ |
| æ¯å°æ—¶ä¸€æ¬¡ | OnCalendar=*-*-* *:00:00 | æ¯å°æ—¶å¼€å§‹æ—¶ |
| æ¯å‘¨ä¸€æ—©ä¸Šä¹ç‚¹ | OnCalendar=Mon 09:00:00 | æ¯å‘¨ä¸€æ—©ä¸Šä¹ç‚¹é’Ÿ |

å°±è¿™æ ·ï¼Œè½»æ¾æå®š Systemd å®šæ—¶å™¨ï¼å¸Œæœ›è¿™èƒ½è®©å¤§å®¶è§‰å¾—å®šæ—¶ä»»åŠ¡æ²¡é‚£ä¹ˆæ¯ç‡¥ã€‚

- ç¬¬ä¸€å¤©çš„æœˆåˆå®šæ—¶ä»»åŠ¡
  - OnCalendar=--01 00:00:00
  - è¿™è¡¨ç¤ºæ¯ä¸ªæœˆçš„ç¬¬ä¸€å¤©åˆå¤œï¼ˆå‡Œæ™¨0ç‚¹ï¼‰è¿è¡Œä¸€æ¬¡ã€‚
- å‘¨æœ«ä¸‹åˆ2ç‚¹å®šæ—¶ä»»åŠ¡
  - OnCalendar=Sat,Sun 14:00
  - æ¯å‘¨å…­å’Œå‘¨æ—¥ä¸‹åˆä¸¤ç‚¹æ‰§è¡Œä¸€æ¬¡ï¼Œè®°å¾—ç»™è‡ªå·±æ³¡æ¯å’–å•¡å“¦ï¼
- åŠå¹´ä¸€æ¬¡çš„å®šæ—¶ä»»åŠ¡
  - OnCalendar=semiannually
  - è¿™è¡¨ç¤ºä¸€å¹´ä¸¤æ¬¡çš„ä»»åŠ¡ï¼Œå°±åƒæ˜¥åˆ†å’Œç§‹åˆ†ä¸€æ ·è§„å¾‹ã€‚

## systemd å®šæ—¶å™¨è¡¨è¾¾å¼å®ä¾‹ ##

ç°åœ¨ä½ å¯¹systemdå®šæ—¶å™¨è¡¨è¾¾å¼çš„ç»“æ„å’Œè§¦å‘æœºåˆ¶æœ‰äº†åˆæ­¥äº†è§£ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹çœ‹ä¸€äº›å®é™…åº”ç”¨çš„ä¾‹å­å§ï¼
ğŸ’¡
ç³»ç»Ÿå®šæ—¶ä»»åŠ¡çš„è¯­æ³•ä¸cronä¸åŒï¼Œå®ƒæä¾›äº†æ›´å¤šçš„çµæ´»æ€§æ¥è¡¨ç¤ºæ—¶é—´å’Œæ—¥æœŸã€‚

| æè¿° | è¡¨è¾¾å¼ | è¯´æ˜ |
| :---: | :----: | :---: |
| æ¯å‘¨äº”åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼ˆä»…é™å‘¨æœ«ï¼‰ | Sat,Sun --* *:0/5:00 | æ˜ŸæœŸå…­å’Œæ˜ŸæœŸæ—¥çš„æ¯äº”åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œæ³¨æ„ä¸è¦åœ¨ä¼‘æ¯æ—¶æ‰“æ‰°åˆ°è‡ªå·±ï¼ |
| æ¯å¤©åˆå¤œåŠä¸­åˆè¿è¡Œ | --* 0,12:00:00 | æ¯å¤©å‡Œæ™¨é›¶ç‚¹å’Œæ­£åˆåäºŒç‚¹å„è¿è¡Œä¸€æ¬¡ï¼Œå¯ä»¥å®‰æ’åœ¨è¿™ä¸¤ä¸ªæ—¶é—´åƒç‚¹å¿ƒã€‚ |
| å‡Œæ™¨å¼€å§‹æ¯ä¸¤å°æ—¶æ‰§è¡Œä¸€æ¬¡ | --* 0-23/2:00:00 | ä»é›¶ç‚¹åˆ°äºŒåä¸‰ç‚¹æ¯éš”ä¸¤ä¸ªå°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œé€‚åˆé‚£äº›éœ€è¦å®šæ—¶æ£€æŸ¥çš„ä»»åŠ¡ã€‚ |
| æ¯æœˆç¬¬ä¸€å¤©å’Œåäº”æ—¥åˆå¤œè¿è¡Œ | --1,15 0:00:00 | åœ¨æ¯ä¸ªæœˆçš„1å·å’Œ15å·å‡Œæ™¨è¿è¡Œä»»åŠ¡ï¼Œè®°å¾—ç»™è‡ªå·±å®šä¸ªé—¹é’Ÿå“¦ï¼ |

### systemd å®šæ—¶å™¨æ–‡ä»¶ ###

ç°åœ¨æˆ‘ä»¬æ¥äº†è§£ä¸‹systemdå®šæ—¶å™¨æ–‡ä»¶çš„åŸºæœ¬æ„æˆã€‚

ä¸€ä¸ªå…¸å‹çš„systemdå®šæ—¶å™¨æ–‡ä»¶é€šå¸¸åŒ…å«ä»¥ä¸‹ä¸‰éƒ¨åˆ†ï¼š

- Unitï¼šæè¿°è¿™ä¸ªå®šæ—¶å™¨ã€‚
- Timerï¼šæŒ‡å®šè°ƒåº¦ä¿¡æ¯ã€‚
- Installï¼šå®šä¹‰å¯åŠ¨æ–¹å¼å’Œç›®æ ‡ã€‚

è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„å®šæ—¶å™¨æ–‡ä»¶ç¤ºä¾‹ï¼š

```ini
[Unit]
Description=A simple systemd timer

[Timer]
OnBootSec=10min
OnUnitActiveSec=1h
OnCalendar=Mon 10:10

[Install]
WantedBy=multi-user.target
```

- OnBootSec è®¾ç½®å®šæ—¶å™¨åœ¨ç³»ç»Ÿå¯åŠ¨åååˆ†é’Ÿåå¼€å§‹è¿è¡Œã€‚
- OnUnitActiveSec åœ¨æœåŠ¡å¯åŠ¨åä¸€å°æ—¶è§¦å‘ä¸€æ¬¡å®šæ—¶ä»»åŠ¡ï¼Œè¿™è¡¨ç¤ºæ¯ä¸ªå°æ—¶æ‰§è¡Œä¸€æ¬¡ã€‚
- OnCalendar å®šä¹‰äº†æ¯å‘¨ä¸€ä¸Šåˆåç‚¹ååˆ†çš„å®šæ—¶è¿è¡Œæ—¶é—´ã€‚
- Persistent=true è¡¨ç¤ºå¦‚æœé”™è¿‡äº†å®šæ—¶è¿è¡Œçš„æ—¶é—´ï¼Œåœ¨ç³»ç»Ÿé‡å¯æ—¶ä¼šè¡¥ä¸Šé”™è¿‡çš„æ—¶é—´ã€‚
- WantedBy ç¡®ä¿åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨é“¾æ¥åˆ°multi-user.targetï¼Œä½¿å®šæ—¶å™¨å¯ä»¥è‡ªåŠ¨å¼€å§‹æ‰§è¡Œã€‚

æ›´å¤šå…³äºé…ç½®çš„ä¿¡æ¯å¯ä»¥é€šè¿‡manå‘½ä»¤æŸ¥è¯¢ã€‚

### systemd æœåŠ¡æ–‡ä»¶ ###

æ¥ä¸‹æ¥æˆ‘ä»¬è¦çœ‹çœ‹systemdæœåŠ¡æ–‡ä»¶çš„å†…å®¹äº†ã€‚

åƒ systemd å®šæ—¶å™¨æ–‡ä»¶ä¸€æ ·ï¼Œsystemd æœåŠ¡æ–‡ä»¶ä¹Ÿç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š

- Unitï¼šæè¿°æœåŠ¡ã€‚
- Serviceï¼šå®šä¹‰è¦æ‰§è¡Œçš„å†…å®¹ã€‚
- Installï¼šæŒ‡å®šå¦‚ä½•å¯åŠ¨è¯¥å•å…ƒä»¥åŠç›®æ ‡ã€‚

è¿™é‡Œæ˜¯ä¸€ä¸ªç®€å•çš„æœåŠ¡æ–‡ä»¶ç¤ºä¾‹ï¼š

```ini
[Timer]
OnCalendar=Mon-Fri:02:00:00
Persistent=true

[Install]
WantedBy=timers.target
```

åœ¨ Service éƒ¨åˆ†ï¼Œä½ å¯ä»¥è®¾ç½®ä»¥ä¸‹é€‰é¡¹ï¼š

- ExecStartï¼šè¦æ‰§è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬ã€‚
- Restartï¼šå®šä¹‰ä½•æ—¶é‡å¯ï¼Œå¯ä»¥æ˜¯ on-failure æˆ– alwaysã€‚
- RestartSecï¼šé‡å¯å‰ç­‰å¾…çš„æ—¶é—´ã€‚
- StartLimitIntervalï¼šå¦‚æœæœ€å¤§é‡è¯•æ¬¡æ•°è¢«è¾¾åˆ°ï¼Œåˆ™ç­‰å¾…æŒ‡å®šæ—¶é—´åæ‰å…è®¸å†å°è¯•å¯åŠ¨ã€‚
- StartLimitBurstï¼šåœ¨é—´éš”å†…å…è®¸çš„æœ€å¤§å°è¯•æ¬¡æ•°ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœåŠ¡åœ¨æ‰§è¡Œå‘½ä»¤æ—¶å¤±è´¥äº†ï¼Œå®ƒä¼šå°è¯•é‡æ–°å¯åŠ¨2æ¬¡ã€‚å¦‚æœé‡å¯é™åˆ¶å·²ç»è¾¾åˆ°äº†ï¼Œé‚£ä¹ˆå®ƒä¼šåœ¨10åˆ†é’Ÿåå†æ¬¡å°è¯•å¯åŠ¨ã€‚åœ¨æ­¤æœŸé—´ï¼Œé‡å¯è®¡æ•°å™¨ä¼šè¢«é‡ç½®ï¼Œå…è®¸æœåŠ¡å†è¯•ä¸€æ¬¡ã€‚

ä½ å¯ä»¥ä½¿ç”¨ man å‘½ä»¤æ¥è·å–æ›´å¤šå…³äºå®šæ—¶å™¨é…ç½®çš„ä¿¡æ¯ã€‚

## å®æˆ˜æ¼”ç»ƒï¼šè®¾ç½® Systemd å®šæ—¶å™¨ ##

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ¯å‘¨ä¸€è‡³å‘¨äº”æ¯ä¸¤åˆ†é’Ÿå†™å…¥æ–‡ä»¶çš„ç³»ç»Ÿå®šæ—¶å™¨ã€‚é‡è¦æç¤ºï¼šè¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºç¤ºä¾‹ï¼Œç”¨äºå¸®åŠ©ç†è§£ systemd å®šæ—¶å™¨ã€‚åœ¨å®é™…åœºæ™¯ä¸­ï¼Œå¤‡ä»½é€šå¸¸ä¼šåœ¨åˆå¤œæˆ–æ¯éš”ä¸¤å¤©è¿›è¡Œä¸€æ¬¡ã€‚è¿™é‡Œä½¿ç”¨2åˆ†é’Ÿçš„æ—¶é—´é—´éš”æ˜¯ä¸ºäº†å­¦ä¹ ç›®çš„ï¼Œä»¥ä¾¿å¿«é€Ÿçœ‹åˆ°ç»“æœã€‚

æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤åˆ›å»ºå¹¶æµ‹è¯•ä¸€ä¸ªsystemdå®šæ—¶å™¨ï¼š

### ç¬¬ä¸€æ­¥ï¼šç¼–å†™è„šæœ¬ ###

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªåä¸º backup.sh çš„è„šæœ¬ï¼Œè¯¥è„šæœ¬ç”± systemd å®šæ—¶å™¨éœ€è¦è¿è¡Œã€‚

æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š

```bash
#!/bin/bash
echo "Backup Completed! $(date)" >> /tmp/backup_output.log
```

è¿™ä¸ªæ–‡ä»¶ä¼šåœ¨ /tmp/backup_output.log ä¸­å†™å…¥â€œBackup Completed!â€åŠå½“å‰æ—¶é—´å’Œæ—¥æœŸä¿¡æ¯ã€‚

å°†è„šæœ¬ backup.sh è®¾ä¸ºå¯æ‰§è¡Œçš„ï¼š

```bash
chmod +x backup.sh
```

### ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæœåŠ¡æ–‡ä»¶ ###

åœ¨æœåŠ¡æ–‡ä»¶ä¸­å®šä¹‰ä½ å¸Œæœ›æ‰§è¡Œçš„ä»»åŠ¡ã€‚æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªåä¸º backup.service çš„æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š

```ini
[Unit]
Description=Backup Script

[Service]
ExecStart=/path/to/backup.sh
Restart=on-failure
RestartSec=10s
StartLimitInterval=60s
StartLimitBurst=5
```

è¿™é‡Œæˆ‘ä»¬å·²ç»æ·»åŠ äº†é‡å¯åŠŸèƒ½ï¼Œå¦‚æœæœåŠ¡ä»¥éé›¶é€€å‡ºç ç»“æŸï¼Œåˆ™ä¼šå°è¯•åœ¨å®šä¹‰çš„æ—¶é—´é—´éš”å†…é‡æ–°å¯åŠ¨è‡³æŒ‡å®šçš„æ¬¡æ•°ã€‚

### ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºå®šæ—¶å™¨æ–‡ä»¶ ###

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æŒ‰ç…§ä»¥ä¸‹æ ¼å¼åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨æ–‡ä»¶ï¼š

```ini
[Unit]
Description=Backup Timer

[Timer]
OnCalendar=Mon-Fri:02:00:00
Persistent=true

[Install]
WantedBy=timers.target
```

ä»¥ä¸Šå°±æ˜¯è®¾ç½® systemd å®šæ—¶å™¨çš„åŸºæœ¬æ­¥éª¤ï¼Œèµ¶ç´§è¯•è¯•å§ï¼

### åˆ›å»ºå®šæ—¶å™¨æ–‡ä»¶ï¼Œè½»æ¾æå®šå¤‡ä»½ä»»åŠ¡ ###

ç°åœ¨æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨æ–‡ä»¶ä»¥å®‰æ’æœåŠ¡ã€‚æˆ‘ä»¬å°†è¿™ä¸ªæ–‡ä»¶å‘½åä¸º backup.timerã€‚

åœ¨æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š

```ini
[Timer]
OnCalendar=Mon..Fri *-*-* *:0/2:00
Persistent=true
```
è¿™é‡Œï¼Œè¡¨è¾¾å¼ Mon..Fri *-*-* *:0/2:00 è¡¨ç¤ºä»å‘¨ä¸€åˆ°å‘¨äº”æ¯ä¸¤åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ä»»åŠ¡ã€‚è€Œ Persistent=true åˆ™ç¡®ä¿åœ¨ç³»ç»Ÿé‡å¯åæ‰§è¡Œä»»ä½•é”™è¿‡çš„è¿è¡Œã€‚

### å¯ç”¨å¹¶å¯åŠ¨å®šæ—¶å™¨ ###

è¦è®©ç³»ç»Ÿè¯†åˆ«æ–°çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°åŠ è½½ systemdï¼š

```bash
sudo systemctl daemon-reload
```

ç„¶åå¯ç”¨å’Œå¯åŠ¨å®šæ—¶å™¨ï¼š

```bash
sudo systemctl enable backup.timer
sudo systemctl start backup.timer
```

### éªŒè¯å®šæ—¶å™¨çŠ¶æ€ ###

è¿‡ä¸¤åˆ†é’Ÿåï¼Œæ£€æŸ¥ /tmp/backup_output.log æ–‡ä»¶ï¼Œçœ‹çœ‹æ˜¯å¦æ¯ä¸¤åˆ†é’Ÿå†™å…¥ä¸€æ¬¡ã€‚

ä½ å¯ä»¥çœ‹åˆ°æ–‡ä»¶ä¸­ç¡®å®æ¯ä¸¤åˆ†é’Ÿè¢«å†™å…¥äº†ä¸€æ¬¡ã€‚

è®©æˆ‘ä»¬æŸ¥çœ‹ backup.service çš„æ—¥å¿—ä»¥äº†è§£å…¶è¾“å‡ºæƒ…å†µï¼š

```bash
journalctl -u backup.service
```

ä½ ä¼šå‘ç°åœ¨æ—¥å¿—é‡Œ backup.service æ¯ä¸¤åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡å¤‡ä»½è„šæœ¬ï¼Œå¹¶åœ¨å®Œæˆä»»åŠ¡åæˆåŠŸåœæ­¢æœåŠ¡ã€‚

ä½ è¿˜å¯ä»¥åˆ—å‡ºæ‰€æœ‰å·²å®‰æ’çš„å®šæ—¶å™¨ï¼š

```bash
systemctl list-timers --all
```

### æ¸…ç†å®šæ—¶å™¨ ###

ä¸€æ—¦ä¸å†éœ€è¦è¯¥å®šæ—¶å™¨ï¼Œä½ å¯ä»¥é€‰æ‹©åœæ­¢æˆ–åˆ é™¤å®ƒã€‚

å¦‚æœä½ æƒ³åœæ­¢å®šæ—¶å™¨ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
sudo systemctl stop backup.timer
```

å¦‚æœä½ æƒ³å½»åº•ç§»é™¤å®šæ—¶å™¨ï¼Œåˆ™éœ€åˆ é™¤ backup.timer å’Œ backup.service æ–‡ä»¶ï¼Œå¹¶é‡æ–°åŠ è½½ systemdï¼š

```bash
rm /etc/systemd/system/backup.timer
rm /etc/systemd/system/backup.service
sudo systemctl daemon-reload
```

## è§£å†³ Systemd å®šæ—¶å™¨é—®é¢˜ ##

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·å°è¯•ä»¥ä¸‹æ­¥éª¤æ¥è§£å†³é—®é¢˜ï¼š

- å¦‚æœå¯¹å®šæ—¶å™¨æˆ–æœåŠ¡æ–‡ä»¶è¿›è¡Œäº†ä¿®æ”¹ï¼Œéœ€è¦é‡æ–°åŠ è½½ systemdï¼š

```bash
sudo systemctl daemon-reload
```

- ç›´æ¥å¯åŠ¨æœåŠ¡ä»¥ç¡®ä¿å…¶æ­£å¸¸å·¥ä½œï¼š

```bash
sudo systemctl start <service-name>.service
```

- æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ï¼š

```bash
journalctl -u <timer-name>.service
```

- æ£€æŸ¥å®šæ—¶å™¨çŠ¶æ€ï¼š

```bash
sudo systemctl status <timer-name>.timer
```

## Systemd å®šæ—¶å™¨çš„ä¼˜åŠ¿ ##

- ä½¿ç”¨ journalctl æŸ¥çœ‹å®šæ—¶å™¨å’ŒæœåŠ¡çš„æ—¥å¿—ä¿¡æ¯ã€‚
- é€šè¿‡è®¾ç½® Persistent=trueï¼Œåœ¨ç³»ç»Ÿé‡å¯åå¯ä»¥æ‰§è¡Œä»»ä½•é”™è¿‡çš„ä»»åŠ¡ã€‚
- ä½¿ç”¨ systemctl status è½»æ¾æ£€æŸ¥å®šæ—¶å™¨å’ŒæœåŠ¡çš„çŠ¶æ€ã€‚
- å®šæ—¶å™¨ä¸ systemd æœåŠ¡ç›´æ¥é›†æˆï¼Œç®€åŒ–äº†ä¾èµ–å…³ç³»ç®¡ç†ã€‚

## OnCalendarçš„é­”æ³•æ—¶åˆ» ##

OnCalendarè¿™ä¸ªå®¶ä¼™å°±åƒæ˜¯ä½ çš„ç§äººè°ƒåº¦å‘˜ï¼Œæ— è®ºæ˜¯æ—¥å¸¸å¤‡ä»½è¿˜æ˜¯ç³»ç»Ÿç»´æŠ¤ä»»åŠ¡ï¼Œå®ƒéƒ½èƒ½è½»æ¾æå®šã€‚æ¯”å¦‚å®šæ—¶åœ¨å¯åŠ¨åå‡ ç§’å†…æ‰§è¡ŒæŸä¸ªæ“ä½œï¼ˆç”¨ OnBootSecï¼‰ï¼Œæˆ–è€…åœ¨æœåŠ¡æ´»è·ƒä¸€æ®µæ—¶é—´ä¹‹åæ‰§è¡ŒæŸäº›äº‹æƒ…ï¼ˆç”¨ OnUnitActiveSecï¼‰ã€‚

## çœŸå®ä¸–ç•Œçš„é­”æ³•æ—¶åˆ» ##

è¿™é‡Œæœ‰ä¸€äº›å¸¸è§çš„åœºæ™¯ï¼Œè®©ä½ çœ‹çœ‹systemd timersæ˜¯å¦‚ä½•å¤§å±•ç¥å¨çš„ï¼š

- æ—¥å¸¸å¤‡ä»½ï¼šå®šæ—¶åˆ›å»ºé‚£äº›ä»¤äººå¤´ç–¼çš„ç³»ç»Ÿå¿«ç…§ã€‚
- è‡ªåŠ¨åŒ–ç»´æŠ¤ä»»åŠ¡ï¼šä¾‹å¦‚æ—¥å¿—æ¸…ç†ã€ç£ç›˜æ•´ç†å’Œæ›´æ–°ç®¡ç†ã€‚è¿™äº›æ´»å„¿äº¤ç»™systemd timersï¼Œä½ å°±å¯ä»¥æ”¾å¿ƒåœ°å–æ¯å’–å•¡äº†ï¼
- å¥åº·æ£€æŸ¥è„šæœ¬ï¼šå®šæœŸè¿è¡Œç›‘æ§è„šæœ¬ä»¥ç¡®ä¿ä¸€åˆ‡éƒ½æ­£å¸¸è¿è½¬ã€‚

## ç»“è®º ##

Systemd timerså°±åƒæ˜¯Linuxä¸–ç•Œçš„é­”æ³•æ£’ï¼Œå®ƒä»¬æ˜¯ç°ä»£cronçš„æ›¿ä»£å“ï¼Œæä¾›äº†å¢å¼ºçš„åŠŸèƒ½ã€æ›´å¥½çš„é›†æˆå’Œæ›´å¼ºå¤§çš„æ—¥å¿—è®°å½•èƒ½åŠ›ã€‚æ— è®ºæ˜¯ç®¡ç†å¤‡ä»½ã€æ‰§è¡Œç»´æŠ¤ä»»åŠ¡è¿˜æ˜¯è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œsystemd timerséƒ½èƒ½ä¸ºä½ æä¾›ä¸€ä¸ªçµæ´»ä¸”å¯é çš„è§£å†³æ–¹æ¡ˆï¼

> æ¸©é¦¨æç¤ºï¼š ä¸è¦çŠ¹è±«ï¼Œèµ¶å¿«è¯•è¯•systemd timerså§ï¼ä½ ä¼šå‘ç°ä½ çš„Linuxç¯å¢ƒå˜å¾—æ›´åŠ ç®€å•å’Œé«˜æ•ˆã€‚
